<!doctype html>
<html lang="id">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ujian Online Informatika - SMPS Muhammadiyah Karimun</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html, body {
      height: 100%;
      width: 100%;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-20px); }
    }
    
    @keyframes slide-in {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.5), 0 0 40px rgba(59, 130, 246, 0.3); }
      50% { box-shadow: 0 0 30px rgba(59, 130, 246, 0.8), 0 0 60px rgba(59, 130, 246, 0.5); }
    }
    
    @keyframes bounce-in {
      0% { transform: scale(0.3); opacity: 0; }
      50% { transform: scale(1.05); }
      70% { transform: scale(0.9); }
      100% { transform: scale(1); opacity: 1; }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }
    
    .animate-float {
      animation: float 3s ease-in-out infinite;
    }
    
    .slide-in {
      animation: slide-in 0.5s ease-out forwards;
    }
    
    .bounce-in {
      animation: bounce-in 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    .shake {
      animation: shake 0.5s ease-in-out;
    }
    
    .glass-effect {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .neon-card {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.95) 100%);
      border: 2px solid rgba(59, 130, 246, 0.3);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 0 20px rgba(59, 130, 246, 0.1);
    }
    
    .neon-card:hover {
      border-color: rgba(59, 130, 246, 0.6);
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.4), 0 0 30px rgba(59, 130, 246, 0.3);
      transform: translateY(-5px);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .glow-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
      animation: pulse-glow 2s infinite;
    }
    
    .glow-button:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 30px rgba(102, 126, 234, 0.6);
    }
    
    .answer-option {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.8) 100%);
      border: 2px solid rgba(100, 116, 139, 0.3);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .answer-option:hover {
      border-color: rgba(59, 130, 246, 0.6);
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(37, 99, 235, 0.2) 100%);
      transform: translateX(8px);
    }
    
    .answer-option.selected {
      border-color: #3b82f6;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(37, 99, 235, 0.3) 100%);
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
    }

    .answer-option.hidden-option {
      opacity: 0.3;
      pointer-events: none;
      background: linear-gradient(135deg, rgba(100, 116, 139, 0.2) 0%, rgba(71, 85, 105, 0.2) 100%);
    }

    .autocomplete-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.98) 0%, rgba(15, 23, 42, 0.98) 100%);
      border: 2px solid rgba(59, 130, 246, 0.5);
      border-radius: 12px;
      max-height: 300px;
      overflow-y: auto;
      z-index: 1000;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 0 20px rgba(59, 130, 246, 0.3);
      margin-top: 8px;
      backdrop-filter: blur(10px);
    }

    .autocomplete-item {
      padding: 12px 16px;
      cursor: pointer;
      color: white;
      transition: all 0.2s ease;
      border-bottom: 1px solid rgba(100, 116, 139, 0.2);
    }

    .autocomplete-item:hover {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(37, 99, 235, 0.3) 100%);
      padding-left: 24px;
    }

    .autocomplete-item:last-child {
      border-bottom: none;
    }

    .autocomplete-highlight {
      background: rgba(59, 130, 246, 0.4);
      font-weight: bold;
      padding: 2px 4px;
      border-radius: 4px;
    }

    .question-grid-item {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid rgba(100, 116, 139, 0.3);
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.8) 100%);
    }

    .question-grid-item:hover {
      transform: scale(1.1);
      border-color: rgba(59, 130, 246, 0.6);
    }

    .question-grid-item.answered {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.3) 0%, rgba(21, 128, 61, 0.3) 100%);
      border-color: #22c55e;
    }

    .question-grid-item.current {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.5) 0%, rgba(37, 99, 235, 0.5) 100%);
      border-color: #3b82f6;
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.6);
    }

    .timer-warning {
      animation: pulse-glow 1s infinite;
      color: #ef4444 !important;
    }

    .live-indicator {
      width: 12px;
      height: 12px;
      background: #ef4444;
      border-radius: 50%;
      animation: pulse-glow 1.5s infinite;
    }

    .tab-button {
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: bold;
      transition: all 0.3s ease;
      background: rgba(100, 116, 139, 0.3);
      color: #94a3b8;
      border: 2px solid transparent;
    }

    .tab-button.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: rgba(102, 126, 234, 0.5);
    }

    .tab-button:hover:not(.active) {
      background: rgba(100, 116, 139, 0.5);
      color: white;
    }

    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 99;
      display: none;
      backdrop-filter: blur(5px);
    }

    .sidebar-overlay.show {
      display: block;
    }

    .sidebar {
      position: fixed;
      top: 0;
      left: -400px;
      width: 350px;
      max-width: 90%;
      height: 100%;
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.98) 0%, rgba(30, 41, 59, 0.98) 100%);
      z-index: 100;
      transition: left 0.3s ease-in-out;
      box-shadow: 8px 0 32px rgba(0, 0, 0, 0.5);
      border-right: 2px solid rgba(59, 130, 246, 0.5);
      overflow-y: auto;
    }

    .sidebar.show {
      left: 0;
    }

    .hamburger-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 101;
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.9) 0%, rgba(37, 99, 235, 0.9) 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
      transition: all 0.3s ease;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .hamburger-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 30px rgba(59, 130, 246, 0.6);
    }

    .hamburger-icon {
      width: 24px;
      height: 20px;
      position: relative;
      transform: rotate(0deg);
      transition: 0.3s ease-in-out;
    }

    .hamburger-icon span {
      display: block;
      position: absolute;
      height: 3px;
      width: 100%;
      background: white;
      border-radius: 9px;
      opacity: 1;
      left: 0;
      transform: rotate(0deg);
      transition: 0.25s ease-in-out;
    }

    .hamburger-icon span:nth-child(1) {
      top: 0px;
    }

    .hamburger-icon span:nth-child(2) {
      top: 8px;
    }

    .hamburger-icon span:nth-child(3) {
      top: 16px;
    }

    .hamburger-btn.open .hamburger-icon span:nth-child(1) {
      top: 8px;
      transform: rotate(135deg);
    }

    .hamburger-btn.open .hamburger-icon span:nth-child(2) {
      opacity: 0;
      left: -60px;
    }

    .hamburger-btn.open .hamburger-icon span:nth-child(3) {
      top: 8px;
      transform: rotate(-135deg);
    }

    .cancel-exam-btn {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.9) 0%, rgba(220, 38, 38, 0.9) 100%);
      padding: 12px 20px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(239, 68, 68, 0.4);
      transition: all 0.3s ease;
      border: 2px solid rgba(255, 255, 255, 0.2);
      width: 100%;
    }

    .cancel-exam-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 30px rgba(239, 68, 68, 0.6);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full w-full" style="margin: 0; padding: 0;"><!-- Background Image Layer -->
  <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: url('https://images.hdqwalls.com/wallpapers/bthumb/stellar-cluster-illuminating-the-night-sky-zg.jpg') center/cover no-repeat; z-index: 0; opacity: 0.4;"></div><!-- Dark Overlay -->
  <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, rgba(15, 23, 42, 0.85) 0%, rgba(30, 41, 59, 0.85) 50%, rgba(51, 65, 85, 0.85) 100%); z-index: 1; pointer-events: none;"></div>
  <div id="app" style="position: relative; z-index: 10; width: 100%; min-height: 100%;"><!-- Landing Page -->
   <div id="landingPage" class="w-full min-h-full p-4 md:p-8"><!-- Header -->
    <div class="text-center mb-10 bounce-in">
     <div class="flex justify-center mb-6">
      <div class="relative">
       <div class="absolute inset-0 bg-blue-500 opacity-30 blur-3xl rounded-full"></div><img src="https://www.smpsmuhammadiyahkarimun.sch.id/assets/images/logo.png" alt="Logo SMP Swasta Muhammadiyah Karimun" class="w-32 h-32 animate-float relative z-10 object-contain" onerror="this.src=''; this.alt='Logo sekolah'; this.style.display='none';">
      </div>
     </div>
     <h1 class="text-5xl md:text-7xl font-black text-white mb-4 tracking-tight" style="text-shadow: 0 4px 20px rgba(0,0,0,0.3), 0 0 40px rgba(255,255,255,0.2);">UJIAN ONLINE INFORMATIKA</h1>
     <p class="text-2xl md:text-3xl text-white font-bold" style="text-shadow: 0 2px 10px rgba(0,0,0,0.3);">SMP SWASTA MUHAMMADIYAH KARIMUN</p>
    </div><!-- Form Input -->
    <div class="w-full max-w-2xl mx-auto glass-effect rounded-3xl p-8 neon-card slide-in">
     <div class="text-center mb-8">
      <h2 class="text-3xl font-bold text-white mb-2">Data Peserta Ujian</h2>
      <div class="w-24 h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 mx-auto rounded-full"></div>
     </div>
     <form id="examForm" class="space-y-6">
      <div><label for="namaSiswa" class="block text-blue-300 font-bold mb-3 text-lg">Nama Siswa</label>
       <div style="position: relative;"><input type="text" id="namaSiswa" required autocomplete="off" class="w-full px-6 py-4 bg-slate-900 bg-opacity-70 text-white rounded-xl border-2 border-slate-600 focus:border-blue-400 focus:outline-none transition-all text-lg backdrop-blur" placeholder="Ketik nama Anda (saran akan muncul)" style="box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
        <div id="autocompleteDropdown" class="autocomplete-dropdown" style="display: none;"></div>
       </div>
      </div>
      <div><label for="pilihKelas" class="block text-purple-300 font-bold mb-3 text-lg">Pilih Kelas</label> <select id="pilihKelas" required class="w-full px-6 py-4 bg-slate-900 bg-opacity-70 text-white rounded-xl border-2 border-slate-600 focus:border-purple-400 focus:outline-none transition-all cursor-pointer text-lg backdrop-blur" style="box-shadow: 0 4px 15px rgba(0,0,0,0.2);"> <option value="">-- Pilih Kelas --</option> <option value="Kelas 7A">Kelas 7A</option> <option value="Kelas 7B">Kelas 7B</option> <option value="Kelas 8">Kelas 8</option> <option value="Kelas 9A">Kelas 9A</option> <option value="Kelas 9B">Kelas 9B</option> </select>
      </div><button type="submit" id="btnMulai" class="glow-button w-full text-white font-black py-5 px-8 rounded-xl transition-all transform text-xl mt-8"> MULAI UJIAN SEKARANG </button>
     </form>
    </div><!-- Admin Login Button -->
    <div class="w-full max-w-2xl mx-auto mt-8 text-center"><button id="btnAdminLogin" class="bg-gradient-to-r from-slate-700 to-slate-800 text-slate-400 hover:text-white px-6 py-3 rounded-lg hover:from-slate-600 hover:to-slate-700 transition-all text-sm font-bold border border-slate-600"> Admin Login </button>
    </div><!-- About Section -->
    <div class="w-full max-w-4xl mx-auto mt-12 slide-in">
     <div class="glass-effect neon-card rounded-3xl p-8 text-center">
      <div class="mb-6">
       <h3 class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 mb-4">TENTANG APLIKASI INI</h3>
       <div class="w-32 h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 mx-auto rounded-full mb-6"></div>
      </div>
      <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-6 mb-6 border border-blue-500 border-opacity-30">
       <p class="text-white text-lg leading-relaxed mb-4">Aplikasi <span class="font-bold text-blue-400">Ujian Online Informatika</span> ini dirancang khusus untuk memberikan pengalaman ujian yang <span class="font-bold text-purple-400">modern, interaktif, dan aman</span> bagi siswa-siswi SMPS Muhammadiyah Karimun.</p>
       <p class="text-slate-300 text-base leading-relaxed">Dilengkapi dengan sistem <span class="font-bold text-green-400">monitoring otomatis</span>, <span class="font-bold text-yellow-400">bantuan Pak Riski</span>, dan fitur <span class="font-bold text-pink-400">50:50</span> untuk membantu proses pembelajaran yang lebih efektif.</p>
      </div>
      <div class="bg-gradient-to-r from-green-900 to-emerald-900 bg-opacity-40 rounded-xl p-5 border border-green-500 border-opacity-40">
       <p class="text-white text-lg font-bold text-center">Dikembangkan oleh : Riski Alpian Ramadhani</p>
      </div>
     </div>
    </div>
   </div><!-- Exam Page -->
   <div id="examPage" class="w-full min-h-full hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow-y: auto;"><!-- Hamburger Button -->
    <div id="hamburgerBtn" class="hamburger-btn">
     <div class="hamburger-icon"><span></span> <span></span> <span></span>
     </div>
    </div><!-- Sidebar Overlay -->
    <div id="sidebarOverlay" class="sidebar-overlay"></div><!-- Sidebar -->
    <div id="sidebar" class="sidebar">
     <div class="p-6">
      <div class="mb-6">
       <h3 class="text-white text-2xl font-bold mb-2 flex items-center gap-2"><span>üìã</span> Navigasi Soal</h3>
       <p class="text-slate-400 text-sm">Klik nomor untuk lompat ke soal</p>
      </div>
      <div id="sidebarQuestionGrid" class="grid grid-cols-5 gap-2 mb-6"><!-- Question numbers will be rendered here -->
      </div>
      <div class="pt-4 border-t border-slate-600">
       <div class="flex items-center gap-2 text-sm text-slate-300 mb-2">
        <div class="w-4 h-4 rounded bg-gradient-to-br from-green-600 to-green-700"></div><span>Terjawab</span>
       </div>
       <div class="flex items-center gap-2 text-sm text-slate-300 mb-2">
        <div class="w-4 h-4 rounded bg-gradient-to-br from-blue-600 to-blue-700"></div><span>Soal Sekarang</span>
       </div>
       <div class="flex items-center gap-2 text-sm text-slate-300 mb-4">
        <div class="w-4 h-4 rounded bg-gradient-to-br from-slate-700 to-slate-800"></div><span>Belum Dijawab</span>
       </div><!-- Cancel Exam Button --> <button id="cancelExamBtnFloating" class="cancel-exam-btn"> <span class="text-xl">‚ùå</span> <span class="text-white font-bold">Batalkan Ujian</span> </button>
      </div>
     </div>
    </div>
    <div class="w-full max-w-7xl mx-auto p-4 md:p-6">
     <div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><!-- Main Exam Area (Left - 2 columns) -->
      <div class="lg:col-span-2 space-y-6"><!-- Header Info with Timer -->
       <div class="glass-effect neon-card rounded-3xl p-6">
        <div class="flex justify-between items-center flex-wrap gap-4">
         <div>
          <h2 class="text-2xl font-bold text-white" id="examStudentName">Nama Siswa</h2>
          <p class="text-blue-300" id="examStudentClass">Kelas</p>
         </div>
         <div class="text-right space-y-2">
          <div>
           <p class="text-slate-300 text-sm">Waktu Tersisa</p>
           <p class="text-white text-3xl font-black" id="timerDisplay">01:30:00</p>
          </div>
          <div class="bg-red-900 bg-opacity-30 rounded-lg px-3 py-2 border border-red-500">
           <p class="text-red-300 text-xs">‚ö†Ô∏è Pelanggaran</p>
           <p class="text-white text-xl font-bold" id="violationCount">0</p>
          </div>
         </div>
        </div>
       </div><!-- Lifeline Buttons -->
       <div class="glass-effect neon-card rounded-3xl p-6">
        <div class="flex gap-3 flex-wrap"><button id="btn5050" class="flex-1 min-w-[200px] bg-gradient-to-r from-yellow-600 to-yellow-700 text-white font-bold py-3 px-4 rounded-xl hover:from-yellow-700 hover:to-yellow-800 transition-all disabled:opacity-50 disabled:cursor-not-allowed"> <span class="text-2xl mr-2">üéØ</span> <span>50:50 (<span id="count5050">2</span>)</span> </button> <button id="btnAskRiski" class="flex-1 min-w-[200px] bg-gradient-to-r from-green-600 to-green-700 text-white font-bold py-3 px-4 rounded-xl hover:from-green-700 hover:to-green-800 transition-all disabled:opacity-50 disabled:cursor-not-allowed"> <span class="text-2xl mr-2">üë®‚Äçüè´</span> <span>Tanya Pak Riski (<span id="countAskRiski">3</span>)</span> </button>
        </div>
       </div><!-- Question Card -->
       <div class="glass-effect neon-card rounded-3xl p-8">
        <div class="mb-6">
         <p class="text-blue-300 font-bold mb-2">Pertanyaan <span id="questionNumber">1</span> dari <span id="totalQuestionsText">40</span></p>
         <h3 class="text-white text-2xl font-bold leading-relaxed" id="questionText">Loading...</h3>
        </div><!-- Answer Options -->
        <div class="space-y-4" id="answerOptions"><!-- Options will be rendered here -->
        </div>
       </div><!-- Navigation Buttons -->
       <div class="flex gap-4 justify-between mb-6"><button id="btnPrevQuestion" class="bg-slate-700 text-white font-bold py-4 px-8 rounded-xl hover:bg-slate-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed"> ‚Üê Sebelumnya </button> <button id="btnNextQuestion" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-4 px-8 rounded-xl hover:from-blue-700 hover:to-purple-700 transition-all"> Selanjutnya ‚Üí </button>
       </div><!-- Submit Button (Always Visible at Bottom) -->
       <div class="mt-8 pt-6 border-t-2 border-slate-600"><button id="btnSubmitExam" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white font-bold py-5 px-8 rounded-xl hover:from-green-700 hover:to-emerald-700 transition-all shadow-lg"> ‚úÖ SELESAI &amp; KUMPULKAN UJIAN </button>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Admin Page -->
   <div id="adminPage" class="w-full hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow-y: auto; z-index: 100; background: linear-gradient(135deg, rgba(15, 23, 42, 0.98) 0%, rgba(30, 41, 59, 0.98) 50%, rgba(51, 65, 85, 0.98) 100%);">
    <div class="w-full max-w-7xl mx-auto p-4 md:p-6">
     <div class="glass-effect neon-card rounded-3xl p-8 mb-6">
      <div class="flex justify-between items-center mb-6">
       <div>
        <h2 class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-400">ADMIN DASHBOARD</h2>
        <p class="text-slate-300 text-sm mt-2">Panel Kontrol Ujian Online</p>
       </div><button id="btnAdminLogout" class="bg-red-600 text-white px-6 py-3 rounded-xl hover:bg-red-700 font-bold transition-all"> Logout </button>
      </div><!-- Tab Navigation -->
      <div class="flex gap-3 mb-6 flex-wrap"><button id="tabOverview" class="tab-button active"> üìä Overview </button> <button id="tabLiveMonitoring" class="tab-button"> üî¥ Live Monitoring </button> <button id="tabResults" class="tab-button"> üìà Hasil Ujian </button> <button id="tabManageStudents" class="tab-button"> üë• Kelola Siswa </button>
      </div><!-- Tab Content -->
      <div id="tabContentOverview"><!-- Statistics Cards -->
       <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
        <div class="bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl p-4 border-2 border-blue-400">
         <p class="text-blue-100 text-sm mb-1">Total Peserta</p>
         <p class="text-white text-3xl font-black" id="adminTotalStudents">0</p>
        </div>
        <div class="bg-gradient-to-br from-green-600 to-green-700 rounded-xl p-4 border-2 border-green-400">
         <p class="text-green-100 text-sm mb-1 flex items-center gap-2"><span class="live-indicator"></span> Sedang Ujian</p>
         <p class="text-white text-3xl font-black" id="adminActiveExams">0</p>
        </div>
        <div class="bg-gradient-to-br from-yellow-600 to-yellow-700 rounded-xl p-4 border-2 border-yellow-400">
         <p class="text-yellow-100 text-sm mb-1">Pelanggaran</p>
         <p class="text-white text-3xl font-black" id="adminTotalViolations">0</p>
        </div>
        <div class="bg-gradient-to-br from-purple-600 to-purple-700 rounded-xl p-4 border-2 border-purple-400">
         <p class="text-purple-100 text-sm mb-1">Rata-rata Skor</p>
         <p class="text-white text-3xl font-black" id="adminAvgScore">0</p>
        </div>
       </div><!-- Data Table -->
       <div class="bg-slate-900 rounded-xl p-4 border border-slate-600 overflow-x-auto">
        <div class="flex justify-between items-center mb-4">
         <h3 class="text-white text-xl font-bold">Semua Data Ujian</h3><button id="btnDownloadPDF" class="bg-gradient-to-r from-red-600 to-red-700 text-white px-4 py-2 rounded-lg hover:from-red-700 hover:to-red-800 font-bold transition-all flex items-center gap-2"> <span>üìÑ</span> Download PDF </button>
        </div>
        <table class="w-full text-left text-white">
         <thead>
          <tr class="border-b-2 border-slate-600">
           <th class="p-3 text-sm font-bold text-blue-300">No</th>
           <th class="p-3 text-sm font-bold text-blue-300">Nama Siswa</th>
           <th class="p-3 text-sm font-bold text-blue-300">Kelas</th>
           <th class="p-3 text-sm font-bold text-blue-300">Skor</th>
           <th class="p-3 text-sm font-bold text-blue-300">Benar</th>
           <th class="p-3 text-sm font-bold text-blue-300">Waktu</th>
           <th class="p-3 text-sm font-bold text-blue-300">Pelanggaran</th>
           <th class="p-3 text-sm font-bold text-blue-300">Riwayat</th>
           <th class="p-3 text-sm font-bold text-blue-300">Status</th>
           <th class="p-3 text-sm font-bold text-blue-300">Aksi</th>
          </tr>
         </thead>
         <tbody id="adminTableBody">
          <tr>
           <td colspan="10" class="p-8 text-center text-slate-400">
            <div class="text-4xl mb-2">
             üìä
            </div><p>Belum ada data ujian</p></td>
          </tr>
         </tbody>
        </table>
       </div>
      </div>
      <div id="tabContentLiveMonitoring" class="hidden">
       <div class="bg-slate-900 rounded-xl p-6 border border-slate-600">
        <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
         <h3 class="text-white text-2xl font-bold flex items-center gap-2"><span class="live-indicator"></span> Live Monitoring - Ujian Berlangsung</h3>
         <div class="flex gap-3"><select id="filterKelas" class="bg-slate-800 text-white px-4 py-2 rounded-lg border border-slate-600"> <option value="">Semua Kelas</option> <option value="Kelas 7A">Kelas 7A</option> <option value="Kelas 7B">Kelas 7B</option> <option value="Kelas 8">Kelas 8</option> <option value="Kelas 9A">Kelas 9A</option> <option value="Kelas 9B">Kelas 9B</option> </select> <button id="btnBroadcastMessage" class="bg-gradient-to-r from-purple-600 to-purple-700 text-white px-4 py-2 rounded-lg hover:from-purple-700 hover:to-purple-800 font-bold transition-all flex items-center gap-2"> <span>üì¢</span> Kirim Pesan Broadcast </button>
         </div>
        </div>
        <div id="liveMonitoringContent" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"><!-- Live monitoring cards will be rendered here -->
        </div>
       </div>
      </div>
      <div id="tabContentResults" class="hidden">
       <div class="bg-slate-900 rounded-xl p-6 border border-slate-600">
        <div class="flex justify-between items-center mb-6">
         <h3 class="text-white text-2xl font-bold">Hasil Ujian Per Kelas</h3><select id="filterKelasResults" class="bg-slate-800 text-white px-4 py-2 rounded-lg border border-slate-600"> <option value="">Semua Kelas</option> <option value="Kelas 7A">Kelas 7A</option> <option value="Kelas 7B">Kelas 7B</option> <option value="Kelas 8">Kelas 8</option> <option value="Kelas 9A">Kelas 9A</option> <option value="Kelas 9B">Kelas 9B</option> </select>
        </div>
        <div class="overflow-x-auto">
         <table class="w-full text-left text-white">
          <thead>
           <tr class="border-b-2 border-slate-600">
            <th class="p-3 text-sm font-bold text-blue-300">No</th>
            <th class="p-3 text-sm font-bold text-blue-300">Nama Siswa</th>
            <th class="p-3 text-sm font-bold text-blue-300">Kelas</th>
            <th class="p-3 text-sm font-bold text-blue-300">Skor</th>
            <th class="p-3 text-sm font-bold text-blue-300">Benar/Total</th>
            <th class="p-3 text-sm font-bold text-blue-300">Waktu</th>
           </tr>
          </thead>
          <tbody id="resultsTableBody">
           <tr>
            <td colspan="6" class="p-8 text-center text-slate-400">
             <div class="text-4xl mb-2">
              üìà
             </div><p>Belum ada hasil ujian</p></td>
           </tr>
          </tbody>
         </table>
        </div>
        <div class="mt-6 text-center"><button id="btnDownloadClassPDF" class="bg-gradient-to-r from-red-600 to-red-700 text-white px-6 py-3 rounded-lg hover:from-red-700 hover:to-red-800 font-bold transition-all inline-flex items-center gap-2"> <span>üìÑ</span> Download PDF Kelas Ini </button>
        </div>
       </div>
      </div>
      <div id="tabContentManageStudents" class="hidden">
       <div class="bg-slate-900 rounded-xl p-6 border border-slate-600">
        <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
         <div>
          <h3 class="text-white text-2xl font-bold">Manajemen Data Siswa</h3>
          <p class="text-slate-400 text-sm mt-1">Kelola daftar siswa yang diizinkan ujian</p>
         </div><button id="btnAddStudent" class="bg-gradient-to-r from-green-600 to-green-700 text-white px-6 py-3 rounded-lg hover:from-green-700 hover:to-green-800 font-bold transition-all flex items-center gap-2"> <span>‚ûï</span> Tambah Siswa </button>
        </div>
        <div class="mb-4">
         <div class="flex gap-3 items-center flex-wrap"><input type="text" id="searchStudentInput" placeholder="Cari nama siswa..." class="flex-1 min-w-[200px] px-4 py-2 bg-slate-800 text-white rounded-lg border border-slate-600 focus:border-blue-400 focus:outline-none"> <button id="btnSortAZ" class="bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg font-bold transition-all"> A-Z </button> <button id="btnRefreshList" class="bg-blue-700 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-bold transition-all"> üîÑ Refresh </button>
         </div>
        </div>
        <div class="bg-gradient-to-br from-blue-900 to-purple-900 bg-opacity-30 rounded-lg p-4 mb-4 border border-blue-500">
         <p class="text-blue-200 text-sm">üí° <strong>Total Siswa Terdaftar:</strong> <span id="totalStudentCount" class="font-bold text-white">0</span></p>
        </div>
        <div class="overflow-x-auto">
         <table class="w-full text-left text-white">
          <thead>
           <tr class="border-b-2 border-slate-600">
            <th class="p-3 text-sm font-bold text-blue-300">No</th>
            <th class="p-3 text-sm font-bold text-blue-300">Nama Siswa</th>
            <th class="p-3 text-sm font-bold text-blue-300">Total Ujian</th>
            <th class="p-3 text-sm font-bold text-blue-300">Aksi</th>
           </tr>
          </thead>
          <tbody id="studentListTableBody">
           <tr>
            <td colspan="4" class="p-8 text-center text-slate-400">
             <div class="text-4xl mb-2">
              üë•
             </div><p>Loading daftar siswa...</p></td>
           </tr>
          </tbody>
         </table>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
    // DATA SOAL - 40 SOAL PER KELAS
    const soalKelas7 = [
      { soal: "Dika menemukan kode biner 01000001. Huruf apa yang muncul setelah ia decode?", pilihan: ["A", "B", "C", "D"], jawaban: 0 },
      { soal: "Kode biner 01000010 mewakili huruf apa dalam ASCII?", pilihan: ["A", "B", "C", "D"], jawaban: 1 },
      { soal: "Jika Rina melihat biner 01000011, huruf apa yang ia temukan?", pilihan: ["B", "C", "D", "E"], jawaban: 1 },
      { soal: "Biner 01000100 menunjukkan huruf apa?", pilihan: ["C", "D", "E", "F"], jawaban: 1 },
      { soal: "Apa hasil decode dari biner 01000101?", pilihan: ["D", "E", "F", "G"], jawaban: 1 },
      { soal: "Jika kata 'RAM' digeser 2 shift menggunakan Caesar Cipher, apa hasilnya?", pilihan: ["TCO", "SBN", "QZL", "PYK"], jawaban: 0 },
      { soal: "Decode biner 01000110 menghasilkan huruf apa?", pilihan: ["E", "F", "G", "H"], jawaban: 1 },
      { soal: "Kode 01000111 dalam biner adalah huruf apa?", pilihan: ["F", "G", "H", "I"], jawaban: 1 },
      { soal: "Caesar Cipher dengan shift 1 dari kata 'CPU' menghasilkan apa?", pilihan: ["DQV", "BOS", "CQT", "ERW"], jawaban: 0 },
      { soal: "Biner 01001000 mewakili huruf apa?", pilihan: ["G", "H", "I", "J"], jawaban: 1 },
      { soal: "Apa yang dimaksud dengan Berpikir Komputasional?", pilihan: ["Cara berpikir seperti komputer", "Cara menggunakan komputer", "Cara memperbaiki komputer", "Cara membeli komputer"], jawaban: 0 },
      { soal: "Hasil decode biner 01001001 adalah huruf apa?", pilihan: ["H", "I", "J", "K"], jawaban: 1 },
      { soal: "Jika 'USB' digeser 3 shift, apa hasilnya?", pilihan: ["XVE", "YWF", "ZXG", "TWB"], jawaban: 0 },
      { soal: "Biner 01001010 menunjukkan huruf apa?", pilihan: ["I", "J", "K", "L"], jawaban: 1 },
      { soal: "Hardware adalah?", pilihan: ["Perangkat lunak", "Perangkat keras yang bisa dilihat dan disentuh", "Pengguna komputer", "Program aplikasi"], jawaban: 1 },
      { soal: "Kode biner 01001011 adalah huruf apa?", pilihan: ["J", "K", "L", "M"], jawaban: 1 },
      { soal: "Software adalah?", pilihan: ["Perangkat keras", "Perangkat lunak atau program", "Pengguna", "Kabel komputer"], jawaban: 1 },
      { soal: "Decode biner 01001100 menghasilkan huruf apa?", pilihan: ["K", "L", "M", "N"], jawaban: 1 },
      { soal: "Caesar Cipher shift 2 dari 'SSD' adalah?", pilihan: ["UUF", "TTD", "VVG", "SSC"], jawaban: 0 },
      { soal: "Biner 01001101 mewakili huruf apa?", pilihan: ["L", "M", "N", "O"], jawaban: 1 },
      { soal: "CPU adalah singkatan dari?", pilihan: ["Central Processing Unit", "Computer Personal Unit", "Central Program Unit", "Computer Processing Unit"], jawaban: 0 },
      { soal: "Apa hasil decode dari 01001110?", pilihan: ["M", "N", "O", "P"], jawaban: 1 },
      { soal: "Jika 'ROM' digeser 1 shift, hasilnya adalah?", pilihan: ["SPN", "QPM", "TQO", "URP"], jawaban: 0 },
      { soal: "Biner 01001111 adalah huruf apa?", pilihan: ["N", "O", "P", "Q"], jawaban: 1 },
      { soal: "RAM adalah singkatan dari?", pilihan: ["Read Access Memory", "Random Access Memory", "Run Access Memory", "Real Access Memory"], jawaban: 1 },
      { soal: "Decode 01010000 menghasilkan huruf apa?", pilihan: ["O", "P", "Q", "R"], jawaban: 1 },
      { soal: "Fungsi Mouse adalah?", pilihan: ["Mengetik", "Menunjuk dan mengklik", "Mencetak", "Menyimpan"], jawaban: 1 },
      { soal: "Kode biner 01010001 menunjukkan huruf apa?", pilihan: ["P", "Q", "R", "S"], jawaban: 1 },
      { soal: "Caesar Cipher dengan shift 2 dari 'DOS' adalah?", pilihan: ["FQU", "EPT", "DOR", "CPQ"], jawaban: 0 },
      { soal: "Biner 01010010 adalah huruf apa?", pilihan: ["Q", "R", "S", "T"], jawaban: 1 },
      { soal: "Monitor termasuk perangkat?", pilihan: ["Input", "Output", "Processing", "Storage"], jawaban: 1 },
      { soal: "Decode 01010011 menghasilkan huruf apa?", pilihan: ["R", "S", "T", "U"], jawaban: 1 },
      { soal: "Printer berfungsi untuk?", pilihan: ["Mencetak dokumen", "Memindai dokumen", "Menampilkan dokumen", "Menyimpan dokumen"], jawaban: 0 },
      { soal: "Biner 01010100 mewakili huruf apa?", pilihan: ["S", "T", "U", "V"], jawaban: 1 },
      { soal: "Jika 'HDD' digeser 3 shift, hasilnya adalah?", pilihan: ["KGG", "JFF", "IGE", "HDD"], jawaban: 0 },
      { soal: "Decode 01010101 adalah huruf apa?", pilihan: ["T", "U", "V", "W"], jawaban: 1 },
      { soal: "Internet adalah?", pilihan: ["Jaringan komputer global", "Program aplikasi", "Perangkat keras", "Sistem operasi"], jawaban: 0 },
      { soal: "Biner 01010110 menunjukkan huruf apa?", pilihan: ["U", "V", "W", "X"], jawaban: 1 },
      { soal: "Caesar Cipher shift 1 dari 'LAN' menghasilkan?", pilihan: ["MBO", "KZM", "NBP", "OCP"], jawaban: 0 },
      { soal: "Kode 01010111 adalah huruf apa?", pilihan: ["V", "W", "X", "Y"], jawaban: 1 }
    ];

    const soalKelas8 = [
      { soal: "Siswa kelas 8 menerima biner untuk kata 'BUKU'. Langkah pertama untuk decode adalah?", pilihan: ["Membagi setiap 8 bit", "Mengubah ke desimal dulu", "Menghitung jumlah bit", "Menulis ulang biner"], jawaban: 0 },
      { soal: "Decomposition artinya?", pilihan: ["Menggabungkan masalah", "Memecah masalah menjadi bagian kecil", "Menghapus masalah", "Membuat masalah baru"], jawaban: 1 },
      { soal: "Jika biner untuk 'DATA' memiliki kesalahan di bit ke-3, apa yang terjadi?", pilihan: ["Huruf pertama salah", "Semua huruf salah", "Tidak ada perubahan", "Hanya spasi yang hilang"], jawaban: 0 },
      { soal: "Algorithm adalah?", pilihan: ["Langkah-langkah sistematis", "Program komputer", "Bahasa pemrograman", "Sistem operasi"], jawaban: 0 },
      { soal: "Untuk decode kata 'BELAJAR' dari biner, berapa kali proses konversi dilakukan?", pilihan: ["5 kali", "6 kali", "7 kali", "8 kali"], jawaban: 2 },
      { soal: "Flowchart digunakan untuk?", pilihan: ["Menggambar", "Menampilkan alur algoritma", "Mengedit foto", "Bermain game"], jawaban: 1 },
      { soal: "Apa yang harus diperiksa pertama kali saat decode biner gagal?", pilihan: ["Jumlah bit per karakter", "Warna layar", "Ukuran font", "Kecepatan internet"], jawaban: 0 },
      { soal: "Variabel dalam pemrograman adalah?", pilihan: ["Konstanta", "Tempat menyimpan nilai", "Fungsi", "Program"], jawaban: 1 },
      { soal: "Biner untuk kata 'SEKOLAH' terdiri dari berapa bit total?", pilihan: ["48 bit", "56 bit", "64 bit", "72 bit"], jawaban: 1 },
      { soal: "Tipe data Integer adalah?", pilihan: ["Bilangan bulat", "Teks", "Bilangan desimal", "Boolean"], jawaban: 0 },
      { soal: "Jika siswa ingin decode kata 'KOMPUTER', langkah apa yang paling efisien?", pilihan: ["Decode semua sekaligus", "Decode per huruf", "Decode per dua huruf", "Decode acak"], jawaban: 1 },
      { soal: "Tipe data String adalah?", pilihan: ["Bilangan", "Teks/karakter", "Boolean", "Array"], jawaban: 1 },
      { soal: "Apa manfaat Pattern Recognition dalam decode biner?", pilihan: ["Mempercepat identifikasi kesalahan", "Membuat biner lebih panjang", "Mengubah warna teks", "Menghapus spasi"], jawaban: 0 },
      { soal: "Operator aritmatika + adalah?", pilihan: ["Penjumlahan", "Pengurangan", "Perkalian", "Pembagian"], jawaban: 0 },
      { soal: "Saat decode 'INTERNET', berapa byte yang diproses?", pilihan: ["6 byte", "7 byte", "8 byte", "9 byte"], jawaban: 2 },
      { soal: "Array adalah?", pilihan: ["Variabel tunggal", "Kumpulan data sejenis", "Fungsi", "Operator"], jawaban: 1 },
      { soal: "Apa yang terjadi jika bit terakhir dari huruf hilang dalam biner?", pilihan: ["Huruf berubah total", "Tidak ada efek", "Hanya ukuran berubah", "Warna berubah"], jawaban: 0 },
      { soal: "Bug dalam pemrograman adalah?", pilihan: ["Fitur", "Kesalahan/error", "Komentar", "Fungsi"], jawaban: 1 },
      { soal: "Untuk encode kata 'MOUSE' ke biner, diperlukan berapa bit?", pilihan: ["32 bit", "40 bit", "48 bit", "56 bit"], jawaban: 1 },
      { soal: "IDE adalah singkatan dari?", pilihan: ["Integrated Development Environment", "Internet Development Environment", "Integrated Design Environment", "Internet Design Environment"], jawaban: 0 },
      { soal: "Jika decode kata 'JARINGAN' menghasilkan huruf aneh, apa penyebab utamanya?", pilihan: ["Bit tidak lengkap 8", "Terlalu banyak huruf", "Font salah", "Layar redup"], jawaban: 0 },
      { soal: "Apa fungsi utama dari Abstraction dalam berpikir komputasional?", pilihan: ["Fokus pada detail penting", "Menghapus semua data", "Membuat lebih rumit", "Mengubah warna"], jawaban: 0 },
      { soal: "Untuk decode 'SOFTWARE', siswa perlu melakukan berapa kali konversi?", pilihan: ["6 kali", "7 kali", "8 kali", "9 kali"], jawaban: 2 },
      { soal: "Apa langkah terakhir dalam proses decode biner ke teks?", pilihan: ["Cek hasil akhir", "Hapus semua bit", "Ubah ke angka", "Cetak dokumen"], jawaban: 0 },
      { soal: "Mengapa keamanan password penting dalam sistem digital?", pilihan: ["Melindungi data pribadi", "Membuat komputer lebih cepat", "Menghemat listrik", "Menambah memori"], jawaban: 0 },
      { soal: "Saat encode 'PROGRAM', format apa yang digunakan untuk setiap huruf?", pilihan: ["7 bit", "8 bit ASCII", "16 bit", "32 bit"], jawaban: 1 },
      { soal: "Jika biner terlalu panjang, teknik apa yang membantu decode lebih mudah?", pilihan: ["Chunking per 8 bit", "Acak semua bit", "Hapus sebagian", "Tambah spasi"], jawaban: 0 },
      { soal: "Apa peran encoding dalam pengiriman pesan digital?", pilihan: ["Mengubah teks jadi format standar", "Menghapus pesan", "Memperlambat kirim", "Mengubah warna pesan"], jawaban: 0 },
      { soal: "Decode 'TEKNOLOGI' memerlukan pemahaman tentang?", pilihan: ["ASCII 8-bit", "Warna RGB", "Ukuran font", "Jenis kertas"], jawaban: 0 },
      { soal: "Apa yang dimaksud dengan bit dalam konteks biner?", pilihan: ["Satuan terkecil data digital", "Jenis huruf", "Warna layar", "Ukuran file"], jawaban: 0 },
      { soal: "Untuk memastikan decode benar, apa yang harus dicek?", pilihan: ["Jumlah bit dan urutan", "Warna background", "Jenis font", "Ukuran layar"], jawaban: 0 },
      { soal: "Saat encode kata 'KELAS', berapa karakter yang diproses?", pilihan: ["4", "5", "6", "7"], jawaban: 1 },
      { soal: "Apa manfaat Pattern Recognition saat bekerja dengan data biner?", pilihan: ["Mengenali pola kesalahan lebih cepat", "Membuat data lebih besar", "Mengubah format", "Menghapus data"], jawaban: 0 },
      { soal: "Jika hasil decode tidak sesuai, langkah pertama adalah?", pilihan: ["Periksa jumlah bit", "Restart komputer", "Ganti keyboard", "Ubah font"], jawaban: 0 },
      { soal: "Apa fungsi byte dalam representasi karakter?", pilihan: ["Menyimpan 1 karakter dalam 8 bit", "Menghapus karakter", "Mengubah warna", "Menambah ukuran"], jawaban: 0 },
      { soal: "Decode kata 'DIGITAL' memerlukan pemahaman tentang?", pilihan: ["Konversi biner ke ASCII", "Penggunaan mouse", "Warna monitor", "Jenis printer"], jawaban: 0 },
      { soal: "Apa yang terjadi jika 1 bit di tengah kata salah?", pilihan: ["1 huruf berubah", "Semua huruf hilang", "Tidak ada efek", "Warna berubah"], jawaban: 0 },
      { soal: "Untuk encode 'SISTEM', diperlukan berapa bit?", pilihan: ["40 bit", "48 bit", "56 bit", "64 bit"], jawaban: 1 },
      { soal: "Apa peran Decomposition dalam memecahkan masalah encoding?", pilihan: ["Membagi per karakter", "Menggabung semua", "Menghapus data", "Mengubah warna"], jawaban: 0 },
      { soal: "Jika decode 'APLIKASI' gagal, apa yang harus diperiksa?", pilihan: ["Kelengkapan 8 bit per huruf", "Jenis mouse", "Ukuran layar", "Warna tema"], jawaban: 0 }
    ];

    const soalKelas9 = [
      { soal: "Decode biner kata LABORATORIUM. Huruf pertama adalah?", pilihan: ["K", "L", "M", "N"], jawaban: 1 },
      { soal: "Shortcut untuk menyalin teks adalah?", pilihan: ["Ctrl+V", "Ctrl+C", "Ctrl+X", "Ctrl+Z"], jawaban: 1 },
      { soal: "Caesar Cipher shift 3 dari kata DATA menghasilkan?", pilihan: ["GDWD", "EBUB", "FCVC", "HFXF"], jawaban: 0 },
      { soal: "HTML adalah singkatan dari?", pilihan: ["Hyper Text Markup Language", "High Text Markup Language", "Hyper Text Making Language", "High Text Making Language"], jawaban: 0 },
      { soal: "Decode biner INFORMATIKA. Huruf ke-5 adalah?", pilihan: ["M", "N", "R", "O"], jawaban: 2 },
      { soal: "CSS adalah singkatan dari?", pilihan: ["Cascading Style Sheets", "Computer Style Sheets", "Cascading System Sheets", "Computer System Sheets"], jawaban: 0 },
      { soal: "Shortcut untuk mencetak dokumen adalah?", pilihan: ["Ctrl+S", "Ctrl+P", "Ctrl+O", "Ctrl+N"], jawaban: 1 },
      { soal: "Caesar Cipher shift 5 dari KODE menghasilkan?", pilihan: ["PTIJ", "QUJK", "RVKL", "SWLM"], jawaban: 0 },
      { soal: "JavaScript digunakan untuk?", pilihan: ["Struktur web", "Styling web", "Interaktivitas web", "Database web"], jawaban: 2 },
      { soal: "Decode biner MUHAMMADIYAH. Huruf terakhir adalah?", pilihan: ["G", "H", "I", "J"], jawaban: 1 },
      { soal: "Shortcut untuk membatalkan aksi terakhir adalah?", pilihan: ["Ctrl+Y", "Ctrl+Z", "Ctrl+X", "Ctrl+C"], jawaban: 1 },
      { soal: "Tag HTML untuk heading terbesar adalah?", pilihan: ["<h1>", "<h6>", "<heading>", "<title>"], jawaban: 0 },
      { soal: "Caesar Cipher shift 2 dari SISTEM menghasilkan?", pilihan: ["UKUVGO", "TJTUFO", "VMXWHP", "SLRSDN"], jawaban: 0 },
      { soal: "Decode biner TEKNOLOGI. Huruf ke-3 adalah?", pilihan: ["J", "K", "L", "M"], jawaban: 1 },
      { soal: "Shortcut untuk menyimpan file adalah?", pilihan: ["Ctrl+S", "Ctrl+P", "Ctrl+O", "Ctrl+N"], jawaban: 0 },
      { soal: "Tag HTML untuk paragraf adalah?", pilihan: ["<paragraph>", "<pg>", "<p>", "<par>"], jawaban: 2 },
      { soal: "Caesar Cipher shift 4 dari FILE menghasilkan?", pilihan: ["JMPI", "KMQJ", "LNRK", "MOSL"], jawaban: 0 },
      { soal: "Decode biner KOMPUTER. Huruf ke-4 adalah?", pilihan: ["N", "O", "P", "Q"], jawaban: 2 },
      { soal: "Property CSS untuk warna teks adalah?", pilihan: ["text-color", "color", "font-color", "text"], jawaban: 1 },
      { soal: "Shortcut untuk memotong teks adalah?", pilihan: ["Ctrl+C", "Ctrl+V", "Ctrl+X", "Ctrl+Z"], jawaban: 2 },
      { soal: "Caesar Cipher shift 1 dari ENCODE menghasilkan?", pilihan: ["FODPEF", "DMBNCF", "GPEPEG", "HNFQFH"], jawaban: 0 },
      { soal: "Property CSS untuk warna background adalah?", pilihan: ["bg-color", "background-color", "color-bg", "bgcolor"], jawaban: 1 },
      { soal: "Decode biner JARINGAN. Huruf ke-6 adalah?", pilihan: ["F", "G", "A", "N"], jawaban: 2 },
      { soal: "Shortcut untuk menempelkan teks adalah?", pilihan: ["Ctrl+C", "Ctrl+X", "Ctrl+V", "Ctrl+Z"], jawaban: 2 },
      { soal: "Display: none membuat elemen?", pilihan: ["Terlihat", "Inline", "Tersembunyi", "Block"], jawaban: 2 },
      { soal: "Caesar Cipher shift 6 dari CYBER menghasilkan?", pilihan: ["IGDKX", "HFCKW", "JHELZ", "KFIMA"], jawaban: 0 },
      { soal: "Decode biner ALGORITMA. Huruf ke-2 adalah?", pilihan: ["K", "L", "M", "N"], jawaban: 1 },
      { soal: "JavaScript variabel dideklarasikan dengan?", pilihan: ["var, let, const", "int, string", "variable", "declare"], jawaban: 0 },
      { soal: "Shortcut untuk membuka file adalah?", pilihan: ["Ctrl+N", "Ctrl+O", "Ctrl+S", "Ctrl+P"], jawaban: 1 },
      { soal: "Caesar Cipher shift 7 dari NETWORK menghasilkan?", pilihan: ["ULADHYR", "TKZCGXQ", "VMBEIYS", "WNCFJZT"], jawaban: 0 },
      { soal: "JSON adalah singkatan dari?", pilihan: ["JavaScript Object Notation", "JavaScript Online Notation", "Java Standard Object Notation", "Java Source Object Notation"], jawaban: 0 },
      { soal: "Decode biner DATABASE. Huruf pertama adalah?", pilihan: ["C", "D", "E", "F"], jawaban: 1 },
      { soal: "Shortcut untuk membuat file baru adalah?", pilihan: ["Ctrl+N", "Ctrl+O", "Ctrl+S", "Ctrl+P"], jawaban: 0 },
      { soal: "Caesar Cipher shift 3 dari SERVER menghasilkan?", pilihan: ["VHUYHU", "UGTWGT", "WIVXIV", "XJWYJW"], jawaban: 0 },
      { soal: "Decode biner PEMROGRAMAN. Huruf ke-7 adalah?", pilihan: ["P", "R", "A", "M"], jawaban: 2 },
      { soal: "Shortcut untuk mengulangi aksi adalah?", pilihan: ["Ctrl+Z", "Ctrl+Y", "Ctrl+R", "Ctrl+T"], jawaban: 1 },
      { soal: "Caesar Cipher shift 2 dari BINARY menghasilkan?", pilihan: ["DKPCT", "CKPBSZ", "ELQDU", "FMREV"], jawaban: 0 },
      { soal: "Decode biner APLIKASI. Huruf ke-3 adalah?", pilihan: ["K", "L", "M", "N"], jawaban: 1 },
      { soal: "Shortcut untuk menutup jendela adalah?", pilihan: ["Alt+F4", "Ctrl+W", "Ctrl+Q", "Alt+W"], jawaban: 0 },
      { soal: "Caesar Cipher shift 4 dari PYTHON menghasilkan?", pilihan: ["TCXLSR", "SBWKRQ", "UDYMTS", "VEZNTU"], jawaban: 0 }
    ];

    const daftarSiswa = [
      "A'LA FATIR ISROIL", "ADINDA PUTRI DEJA", "Adnan Kamal Rizkyansani Nasution", "Ajiska Mulianda",
      "Aldi Novriansah", "ALEESYA DANIA", "ALIFIYA", "AMANDA CLARISA PUTRI", "Andika Ardiansyah Putra",
      "ANGGI BUNGA LESTARI", "AQILA FATHINA SAKHI", "Ardan Ananta", "ARTANTI SYANDANA", "Athaya",
      "Atikah Zahirah", "Aurel Rabadi", "AVRILLIA KURNIAWATI", "AZZAHRA AQILA HASNA DEWI", "BAKTI ILLAHI",
      "BASIRA ZUTARI", "Cintamy Nurleka", "DHIA PASCARA GISANG", "DISABILA VINENSIA BR SIAGIAN", "DWI PUTRA ANGGARA",
      "EAN KHAIR SYADDAD", "ERICSEN BEN JOSUA", "Fadila Regina Putri", "FAHRIL RIANTA", "FAIZ AIMAN PUTRA",
      "FEBRI PUTRA KIRANA", "FELIX FAIRUS RIQULLAH", "FHANY REGINA PUTRI", "FIKRI FIRMANSAH", "FIRDA",
      "Fitri Septia Wulandari", "GALEH PRIYO WIDAKDO", "GEFAN", "Haikal Abdullah Sahri Khaisah", "HARYADI",
      "IBNU SYAFIUL QOLBI", "IFFA KHALISA KIANDRA USMAN", "IQBAL HANAFI", "IRFAN SAPUTRA", "Jenita Cahya Putry Syam",
      "JESTI RESTU ENJELLIA", "JUMADIL FAJAR", "Kaysa febrianti", "Keisya Putri Wulandari", "KINTA YASIRA DIDIE",
      "LAILA FITRIA", "LAURA ANGRAINI LESTARI", "M. SYAKIF AL MUZAFA", "Marsya Saputri", "MOHAMMAD NADIF HENDRIADI FITRA",
      "MUHAMAD RIZKI ANUGERAH", "MUHAMMAD ALMUKMININ", "MUHAMMAD ALVIN", "Muhammad Arya Nur Hakim", "Muhammad Azril",
      "MUHAMMAD DEVA ALDIANSYAH", "MUHAMMAD HILMAN RABBANI", "MUHAMMAD KHENZU AL BAASITH", "Muhammad Rafi", "MUHAMMAD RIZKY FEBRIAN",
      "MUHAMMAD SAQIF ALFIANO PUTRA", "MUHAMMAD ZIDAN AL HAFIZH", "MUHAMMAD ZIDDAN MAJID", "MUHAMMAD ZUL ADHA", "MUZDALIVA",
      "NABILA ZAHRA PUTRI LESTARI", "NAZIFHA JIHANDA VELLYN", "Nur Zahra Alya Nabila", "NURAFIZA", "NURALYSA",
      "NURHAFIZAH", "NURINDAH NILAM SARI", "OKBARIATUS SAADAH", "PIKA RAMADANI", "PRASSETTIO KURNIAWAN",
      "QURRATUL AIN ALEESYA", "RAHEL STEFANI SIMANJUNTAK", "Rahmadi Ramadhan", "Raja Atharizz Callef Navadiyaan", "Raja Taufik",
      "RAMADHANI", "RATU AQILA BALQIS", "RATU VANESHA", "RENDI SAPUTRA", "RIFKY HAMDANI",
      "RIZKY LANGIT RAMADHAN", "SABILA HANNUM", "SAHILU AIZI KHAIREEN", "SALSABILA NADIN", "SHALSA NABILLA",
      "SHASYA NOVITA ALENA", "SITI NUR AZZAHRA", "SUCI RAMADHANI", "SUHENI", "Syafrizal Kurniawan",
      "SYAHRUL HIDAYAT", "TASYA", "Tohiruddin", "TRI BINTANG HAMUNTAI", "ULFA NUR MASHITA",
      "WINDA YARTIKA LUBIS", "YELMITA FAUZIAH", "ZAIMAH", "ZAKI MAHMUD", "ZAKI TRI SYAHPUTRA",
      "ZAKIYA TULHUSNA", "ZUL KARNAIN"
    ];

    let currentState = {
      namaSiswa: '',
      kelas: '',
      soalList: [],
      currentIndex: 0,
      userAnswers: [],
      lifeline5050: 2,
      lifelineAskRiski: 3,
      violations: 0,
      timeRemaining: 5400,
      timerInterval: null,
      startTime: null,
      hiddenOptions: []
    };

    let allExamData = [];
    let isAdminLoggedIn = false;
    let adminUpdateInterval = null;
    let adminMessages = [];
    let messageCheckInterval = null;

    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioContext = new AudioContext();

    function playBeep() {
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.value = 800;
      oscillator.type = 'sine';
      
      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.5);
    }

    document.addEventListener('visibilitychange', async function() {
      if (document.getElementById('examPage').classList.contains('hidden')) {
        return;
      }
      
      if (document.hidden) {
        currentState.violations++;
        playBeep();
        
        const violationCountElement = document.getElementById('violationCount');
        if (violationCountElement) {
          violationCountElement.textContent = currentState.violations;
        }
        
        await updateStudentProgress();
        
        const violationDiv = document.createElement('div');
        violationDiv.className = 'fixed top-4 right-4 bg-red-600 text-white px-6 py-4 rounded-xl shadow-2xl z-50 shake font-bold';
        violationDiv.innerHTML = `
          <div class="flex items-center gap-3">
            <span class="text-3xl">‚ö†Ô∏è</span>
            <div>
              <p class="text-lg">PELANGGARAN TERDETEKSI!</p>
              <p class="text-sm">Jangan berpindah tab! Pelanggaran: ${currentState.violations}</p>
            </div>
          </div>
        `;
        document.body.appendChild(violationDiv);
        
        setTimeout(() => {
          if (violationDiv && violationDiv.parentNode) {
            document.body.removeChild(violationDiv);
          }
        }, 3000);
      }
    });

    const dataHandler = {
      onDataChanged(data) {
        allExamData = data;
        if (isAdminLoggedIn) {
          updateAdminDashboard();
        }
        
        if (!document.getElementById('examPage').classList.contains('hidden')) {
          checkForMessages(data);
        }
      }
    };

    let displayedMessages = new Set();

    function checkForMessages(data) {
      const messages = data.filter(d => 
        d.target_student === currentState.namaSiswa &&
        d.target_kelas === currentState.kelas &&
        (d.type === 'personal' || d.type === 'broadcast' || d.type === 'cancel')
      );
      
      messages.forEach(msg => {
        if (displayedMessages.has(msg.__backendId)) {
          return;
        }
        
        displayedMessages.add(msg.__backendId);
        
        if (msg.type === 'cancel' && msg.force_reload) {
          if (currentState.timerInterval) {
            clearInterval(currentState.timerInterval);
          }
          
          playBeep();
          
          showModal(
            `
            <div class="text-center">
              <div class="text-6xl mb-4">‚ùå</div>
              <h3 class="text-2xl font-bold text-white mb-3">UJIAN DIBATALKAN</h3>
              <div class="bg-red-900 bg-opacity-30 rounded-lg p-4 border border-red-500 mb-4">
                <p class="text-red-200 text-lg">
                  ${msg.message}
                </p>
              </div>
              <p class="text-slate-300 text-sm">
                Anda akan dikembalikan ke halaman utama
              </p>
            </div>
            `,
            [
              { text: 'OK', type: 'primary', onClick: async () => {
                if (window.dataSdk) {
                  await window.dataSdk.delete(msg);
                }
                displayedMessages.clear();
                showPage('landingPage');
                document.getElementById('namaSiswa').value = '';
                document.getElementById('pilihKelas').value = '';
              }}
            ]
          );
        } else if (msg.type === 'personal' || msg.type === 'broadcast') {
          const messageId = `msg-${msg.__backendId}`;
          
          if (document.getElementById(messageId)) {
            return;
          }
          
          const messageDiv = document.createElement('div');
          messageDiv.id = messageId;
          messageDiv.className = 'fixed top-4 right-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-4 rounded-xl shadow-2xl z-50 bounce-in max-w-md border-2 border-blue-400';
          messageDiv.style.animation = 'bounce-in 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
          messageDiv.innerHTML = `
            <div class="flex items-start gap-3">
              <div class="text-3xl">${msg.type === 'broadcast' ? 'üì¢' : 'üí¨'}</div>
              <div class="flex-1">
                <p class="font-bold text-lg mb-2">${msg.type === 'broadcast' ? 'Pesan Broadcast dari Pak Riski' : 'Pesan dari Pak Riski'}</p>
                <p class="text-blue-100 text-sm leading-relaxed">${msg.message}</p>
                <p class="text-blue-200 text-xs mt-2">${new Date(msg.timestamp).toLocaleTimeString('id-ID')}</p>
              </div>
              <button onclick="this.parentElement.parentElement.remove()" class="text-white hover:text-red-200 font-bold text-xl">√ó</button>
            </div>
          `;
          document.body.appendChild(messageDiv);
          
          playBeep();
          
          setTimeout(async () => {
            if (messageDiv && messageDiv.parentNode) {
              document.body.removeChild(messageDiv);
            }
            if (window.dataSdk) {
              try {
                await window.dataSdk.delete(msg);
              } catch (error) {
                console.error('Error deleting message:', error);
              }
            }
          }, 12000);
        }
      });
    }

    async function initializeDataSdk() {
      if (window.dataSdk) {
        const initResult = await window.dataSdk.init(dataHandler);
        if (!initResult.isOk) {
          console.error("Failed to initialize data SDK");
        }
      }
    }

    function showModal(content, buttons = []) {
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4';
      modal.style.zIndex = '9999';
      modal.style.animation = 'fadeIn 0.3s ease-in-out';
      
      let buttonsHTML = '';
      buttons.forEach((btn, idx) => {
        const btnClass = btn.type === 'primary' 
          ? 'bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700'
          : 'bg-slate-700 hover:bg-slate-600';
        
        buttonsHTML += `
          <button 
            id="modalBtn${idx}" 
            class="${btnClass} flex-1 text-white font-bold py-3 px-6 rounded-xl transition-all"
          >
            ${btn.text}
          </button>
        `;
      });
      
      modal.innerHTML = `
        <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-8 max-w-md w-full border-2 border-blue-500 shadow-2xl" style="animation: bounce-in 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);">
          ${content}
          <div class="flex gap-3 mt-6">
            ${buttonsHTML}
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      setTimeout(() => {
        buttons.forEach((btn, idx) => {
          const btnElement = document.getElementById(`modalBtn${idx}`);
          if (btnElement) {
            btnElement.addEventListener('click', () => {
              if (btn.onClick) btn.onClick();
              if (modal && modal.parentNode) {
                document.body.removeChild(modal);
              }
            });
          }
        });
      }, 100);
      
      return modal;
    }

    function showPage(pageId) {
      const pages = ['landingPage', 'examPage', 'adminPage'];
      pages.forEach(page => {
        const element = document.getElementById(page);
        if (page === pageId) {
          element.classList.remove('hidden');
        } else {
          element.classList.add('hidden');
        }
      });
    }

    function formatTime(seconds) {
      const hours = Math.floor(seconds / 3600);
      const minutes = Math.floor((seconds % 3600) / 60);
      const secs = seconds % 60;
      return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    }

    function startTimer() {
      if (currentState.timerInterval) {
        clearInterval(currentState.timerInterval);
      }
      
      currentState.timerInterval = setInterval(() => {
        currentState.timeRemaining--;
        const timerDisplay = document.getElementById('timerDisplay');
        timerDisplay.textContent = formatTime(currentState.timeRemaining);
        
        if (currentState.timeRemaining === 300) {
          timerDisplay.classList.add('timer-warning');
          showModal(
            `
            <div class="text-center">
              <div class="text-6xl mb-4">‚è∞</div>
              <h3 class="text-2xl font-bold text-white mb-3">WAKTU HAMPIR HABIS!</h3>
              <p class="text-yellow-300 text-lg">
                Waktu tersisa 5 menit lagi!
              </p>
            </div>
            `,
            [
              { text: 'OK, Saya Mengerti', type: 'primary', onClick: () => {} }
            ]
          );
        }
        
        if (currentState.timeRemaining <= 0) {
          clearInterval(currentState.timerInterval);
          submitExam(true);
        }
      }, 1000);
    }

    document.getElementById('examForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const nama = document.getElementById('namaSiswa').value.trim();
      const kelas = document.getElementById('pilihKelas').value;
      
      if (!nama || !kelas) {
        showModal(
          `
          <div class="text-center">
            <div class="text-6xl mb-4">‚ö†Ô∏è</div>
            <h3 class="text-2xl font-bold text-white mb-3">DATA BELUM LENGKAP</h3>
            <p class="text-yellow-300 text-lg">
              Mohon isi nama dan pilih kelas terlebih dahulu!
            </p>
          </div>
          `,
          [
            { text: 'OK', type: 'primary', onClick: () => {} }
          ]
        );
        return;
      }
      
      const namaDitemukan = daftarSiswa.find(siswa => 
        siswa.toLowerCase() === nama.toLowerCase()
      );
      
      if (!namaDitemukan) {
        showModal(
          `
          <div class="text-center">
            <div class="text-6xl mb-4">‚ùå</div>
            <h3 class="text-2xl font-bold text-white mb-3">NAMA TIDAK TERDAFTAR</h3>
            <p class="text-red-300 text-lg leading-relaxed mb-4">
              Nama "<strong>${nama}</strong>" tidak ditemukan dalam daftar siswa!
            </p>
            <div class="bg-yellow-900 bg-opacity-30 rounded-lg p-4 border border-yellow-500">
              <p class="text-yellow-200 text-sm">
                üí° Pastikan nama yang Anda masukkan <strong>sama persis</strong> dengan nama di daftar
              </p>
            </div>
          </div>
          `,
          [
            { text: 'OK, Periksa Lagi', type: 'primary', onClick: () => {} }
          ]
        );
        return;
      }
      
      currentState.namaSiswa = namaDitemukan;
      currentState.kelas = kelas;
      currentState.violations = 0;
      currentState.timeRemaining = 5400;
      currentState.lifeline5050 = 2;
      currentState.lifelineAskRiski = 3;
      currentState.startTime = new Date();
      currentState.hiddenOptions = [];
      
      if (kelas === 'Kelas 7A' || kelas === 'Kelas 7B') {
        currentState.soalList = [...soalKelas7];
      } else if (kelas === 'Kelas 8') {
        currentState.soalList = [...soalKelas8];
      } else if (kelas === 'Kelas 9A' || kelas === 'Kelas 9B') {
        currentState.soalList = [...soalKelas9];
      }
      
      currentState.currentIndex = 0;
      currentState.userAnswers = new Array(currentState.soalList.length).fill(null);
      
      showModal(
        `
        <div class="text-center">
          <div class="text-6xl mb-4">‚úÖ</div>
          <h3 class="text-3xl font-bold text-white mb-3">SELAMAT DATANG!</h3>
          <p class="text-blue-300 text-xl mb-2">${namaDitemukan}</p>
          <p class="text-purple-300 text-lg mb-4">${kelas}</p>
          <div class="bg-blue-900 bg-opacity-30 rounded-lg p-4 border border-blue-500 mb-4">
            <p class="text-blue-200 text-base mb-2">
              üìù Anda akan mengerjakan <strong>${currentState.soalList.length} soal</strong>
            </p>
            <p class="text-blue-200 text-base mb-2">
              ‚è∞ Waktu: <strong>1 Jam 30 Menit</strong>
            </p>
            <p class="text-blue-200 text-base">
              üéØ Bantuan: <strong>50:50 (2x)</strong> & <strong>Tanya Pak Riski (3x)</strong>
            </p>
          </div>
          <div class="bg-red-900 bg-opacity-30 rounded-lg p-4 border border-red-500">
            <p class="text-red-200 text-sm">
              ‚ö†Ô∏è <strong>JANGAN berpindah tab</strong> saat ujian! Sistem akan mendeteksi pelanggaran.
            </p>
          </div>
        </div>
        `,
        [
          { text: 'Mulai Ujian Sekarang', type: 'primary', onClick: async () => {
            showPage('examPage');
            renderQuestion();
            renderQuestionGrid();
            startTimer();
            
            if (window.dataSdk) {
              const examSession = {
                nama_siswa: currentState.namaSiswa,
                kelas: currentState.kelas,
                status: 'sedang_ujian',
                soal_selesai: 0,
                total_soal: currentState.soalList.length,
                violations: 0,
                waktu_mulai: new Date().toISOString(),
                skor: 0,
                jawaban_benar: 0
              };
              await window.dataSdk.create(examSession);
            }
          }}
        ]
      );
    });

    function renderQuestion() {
      const idx = currentState.currentIndex;
      const q = currentState.soalList[idx];
      
      document.getElementById('examStudentName').textContent = currentState.namaSiswa;
      document.getElementById('examStudentClass').textContent = currentState.kelas;
      document.getElementById('questionNumber').textContent = idx + 1;
      document.getElementById('totalQuestionsText').textContent = currentState.soalList.length;
      document.getElementById('violationCount').textContent = currentState.violations;
      
      document.getElementById('questionText').textContent = q.soal;
      
      const optionsContainer = document.getElementById('answerOptions');
      optionsContainer.innerHTML = '';
      
      const hiddenForThisQuestion = currentState.hiddenOptions[idx] || [];
      
      q.pilihan.forEach((option, optIdx) => {
        const isSelected = currentState.userAnswers[idx] === optIdx;
        const isHidden = hiddenForThisQuestion.includes(optIdx);
        
        const optionDiv = document.createElement('div');
        optionDiv.className = `answer-option p-5 rounded-xl cursor-pointer ${isSelected ? 'selected' : ''} ${isHidden ? 'hidden-option' : ''}`;
        optionDiv.innerHTML = `
          <div class="flex items-center gap-4">
            <div class="w-10 h-10 rounded-full border-2 ${isSelected ? 'border-blue-400 bg-blue-500' : 'border-slate-500'} flex items-center justify-center font-bold text-white">
              ${String.fromCharCode(65 + optIdx)}
            </div>
            <p class="text-white text-lg flex-1">${isHidden ? '(Tersembunyi oleh 50:50)' : option}</p>
          </div>
        `;
        
        if (!isHidden) {
          optionDiv.addEventListener('click', async function() {
            currentState.userAnswers[idx] = optIdx;
            renderQuestion();
            renderQuestionGrid();
            await updateStudentProgress();
          });
        }
        
        optionsContainer.appendChild(optionDiv);
      });
      
      const btnPrev = document.getElementById('btnPrevQuestion');
      btnPrev.disabled = idx === 0;
      
      document.getElementById('count5050').textContent = currentState.lifeline5050;
      document.getElementById('countAskRiski').textContent = currentState.lifelineAskRiski;
      document.getElementById('btn5050').disabled = currentState.lifeline5050 <= 0 || hiddenForThisQuestion.length > 0;
      document.getElementById('btnAskRiski').disabled = currentState.lifelineAskRiski <= 0;
    }

    async function updateStudentProgress() {
      if (!window.dataSdk) return;
      
      const soalSelesai = currentState.userAnswers.filter(a => a !== null).length;
      
      const studentSession = allExamData.find(d => 
        d.nama_siswa === currentState.namaSiswa && 
        d.kelas === currentState.kelas && 
        d.status === 'sedang_ujian'
      );
      
      if (studentSession) {
        studentSession.soal_selesai = soalSelesai;
        studentSession.violations = currentState.violations;
        await window.dataSdk.update(studentSession);
      }
    }

    function renderQuestionGrid() {
      const grid = document.getElementById('sidebarQuestionGrid');
      grid.innerHTML = '';
      
      currentState.soalList.forEach((q, idx) => {
        const item = document.createElement('div');
        item.className = 'question-grid-item';
        item.textContent = idx + 1;
        
        if (currentState.userAnswers[idx] !== null) {
          item.classList.add('answered');
        }
        
        if (idx === currentState.currentIndex) {
          item.classList.add('current');
        }
        
        item.addEventListener('click', () => {
          currentState.currentIndex = idx;
          renderQuestion();
          renderQuestionGrid();
          toggleSidebar();
        });
        
        grid.appendChild(item);
      });
    }

    document.getElementById('btn5050').addEventListener('click', function() {
      if (currentState.lifeline5050 <= 0) return;
      
      const idx = currentState.currentIndex;
      const q = currentState.soalList[idx];
      const correctAnswer = q.jawaban;
      
      let wrongAnswers = [];
      for (let i = 0; i < q.pilihan.length; i++) {
        if (i !== correctAnswer) {
          wrongAnswers.push(i);
        }
      }
      
      const shuffle = wrongAnswers.sort(() => 0.5 - Math.random());
      const toHide = shuffle.slice(0, 2);
      
      currentState.hiddenOptions[idx] = toHide;
      currentState.lifeline5050--;
      
      renderQuestion();
      
      showModal(
        `
        <div class="text-center">
          <div class="text-6xl mb-4">üéØ</div>
          <h3 class="text-2xl font-bold text-white mb-3">50:50 DIGUNAKAN!</h3>
          <p class="text-yellow-300 text-lg">
            2 jawaban salah telah dihilangkan!
          </p>
          <p class="text-slate-300 text-sm mt-2">
            Sisa bantuan 50:50: <strong>${currentState.lifeline5050}</strong>
          </p>
        </div>
        `,
        [
          { text: 'OK', type: 'primary', onClick: () => {} }
        ]
      );
    });

    document.getElementById('btnAskRiski').addEventListener('click', function() {
      if (currentState.lifelineAskRiski <= 0) return;
      
      const idx = currentState.currentIndex;
      const q = currentState.soalList[idx];
      const correctAnswer = q.jawaban;
      const correctLetter = String.fromCharCode(65 + correctAnswer);
      
      currentState.lifelineAskRiski--;
      
      const hints = [
        `Menurut Pak Riski, jawabannya kemungkinan besar adalah <strong>${correctLetter}</strong>! üòä`,
        `Pak Riski yakin jawabannya adalah <strong>${correctLetter}</strong>! Percaya sama Pak Riski ya! üëç`,
        `Hmm... Pak Riski rasa jawabannya <strong>${correctLetter}</strong> deh! Semangat! üí™`,
        `Kalau Pak Riski sih pilih <strong>${correctLetter}</strong>! Tapi keputusan akhir di kamu ya! üòâ`
      ];
      
      const randomHint = hints[Math.floor(Math.random() * hints.length)];
      
      showModal(
        `
        <div class="text-center">
          <div class="text-6xl mb-4">üë®‚Äçüè´</div>
          <h3 class="text-2xl font-bold text-white mb-3">BANTUAN PAK RISKI</h3>
          <div class="bg-green-900 bg-opacity-30 rounded-lg p-4 border border-green-500 mb-4">
            <p class="text-green-200 text-lg leading-relaxed">
              ${randomHint}
            </p>
          </div>
          <p class="text-slate-300 text-sm">
            Sisa bantuan Pak Riski: <strong>${currentState.lifelineAskRiski}</strong>
          </p>
        </div>
        `,
        [
          { text: 'Terima Kasih Pak!', type: 'primary', onClick: () => {} }
        ]
      );
    });

    document.getElementById('btnPrevQuestion').addEventListener('click', function() {
      if (currentState.currentIndex > 0) {
        currentState.currentIndex--;
        renderQuestion();
        renderQuestionGrid();
      }
    });

    document.getElementById('btnNextQuestion').addEventListener('click', function() {
      if (currentState.currentIndex < currentState.soalList.length - 1) {
        currentState.currentIndex++;
        renderQuestion();
        renderQuestionGrid();
      }
    });

    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebarOverlay');

    function toggleSidebar() {
      hamburgerBtn.classList.toggle('open');
      sidebar.classList.toggle('show');
      sidebarOverlay.classList.toggle('show');
    }

    hamburgerBtn.addEventListener('click', toggleSidebar);
    sidebarOverlay.addEventListener('click', toggleSidebar);

    document.getElementById('cancelExamBtnFloating').addEventListener('click', function() {
      showModal(
        `
        <div class="text-center">
          <div class="text-6xl mb-4">‚ùå</div>
          <h3 class="text-2xl font-bold text-white mb-3">BATALKAN UJIAN?</h3>
          <p class="text-red-300 text-lg mb-2">
            Yakin ingin membatalkan ujian?
          </p>
          <p class="text-slate-300 text-sm">
            Semua jawaban akan hilang dan tidak dapat dikembalikan!
          </p>
        </div>
        `,
        [
          { text: 'Tidak, Lanjutkan', type: 'secondary', onClick: () => {} },
          { text: 'Ya, Batalkan', type: 'primary', onClick: () => {
            if (currentState.timerInterval) {
              clearInterval(currentState.timerInterval);
            }
            showPage('landingPage');
            document.getElementById('namaSiswa').value = '';
            document.getElementById('pilihKelas').value = '';
          }}
        ]
      );
    });

    document.getElementById('btnSubmitExam').addEventListener('click', function() {
      const unanswered = currentState.userAnswers.filter(a => a === null).length;
      
      if (unanswered > 0) {
        showModal(
          `
          <div class="text-center">
            <div class="text-6xl mb-4">‚ö†Ô∏è</div>
            <h3 class="text-2xl font-bold text-white mb-3">BELUM SELESAI</h3>
            <p class="text-yellow-300 text-lg mb-4">
              Masih ada <strong>${unanswered} soal</strong> yang belum dijawab!
            </p>
            <p class="text-slate-300 text-sm">
              Yakin ingin mengumpulkan ujian sekarang?
            </p>
          </div>
          `,
          [
            { text: 'Periksa Lagi', type: 'secondary', onClick: () => {} },
            { text: 'Ya, Kumpulkan', type: 'primary', onClick: () => {
              submitExam(false);
            }}
          ]
        );
      } else {
        showModal(
          `
          <div class="text-center">
            <div class="text-6xl mb-4">‚úÖ</div>
            <h3 class="text-2xl font-bold text-white mb-3">SELESAI</h3>
            <p class="text-green-300 text-lg mb-4">
              Semua soal sudah dijawab!
            </p>
            <p class="text-slate-300 text-sm">
              Yakin ingin mengumpulkan ujian sekarang?
            </p>
          </div>
          `,
          [
            { text: 'Periksa Lagi', type: 'secondary', onClick: () => {} },
            { text: 'Ya, Kumpulkan', type: 'primary', onClick: () => {
              submitExam(false);
            }}
          ]
        );
      }
    });

    async function submitExam(autoSubmit = false) {
      if (currentState.timerInterval) {
        clearInterval(currentState.timerInterval);
      }
      
      let correct = 0;
      currentState.soalList.forEach((q, idx) => {
        if (currentState.userAnswers[idx] === q.jawaban) {
          correct++;
        }
      });
      
      const total = currentState.soalList.length;
      const score = Math.round((correct / total) * 100);
      const timeElapsed = 5400 - currentState.timeRemaining;
      const timeUsed = formatTime(timeElapsed);
      
      if (window.dataSdk) {
        const examResult = {
          nama_siswa: currentState.namaSiswa,
          kelas: currentState.kelas,
          skor: score,
          jawaban_benar: correct,
          total_soal: total,
          waktu_selesai: timeUsed,
          violations: currentState.violations,
          status: autoSubmit ? 'waktu_habis' : 'selesai',
          waktu_submit: new Date().toISOString()
        };
        await window.dataSdk.create(examResult);
      }
      
      const warningMessage = autoSubmit 
        ? '<div class="bg-red-900 bg-opacity-30 rounded-lg p-3 mb-4 border border-red-500"><p class="text-red-200 text-sm">‚è∞ Waktu Habis - Ujian otomatis dikumpulkan</p></div>'
        : '';
      
      const violationWarning = currentState.violations > 0
        ? `<div class="bg-yellow-900 bg-opacity-30 rounded-lg p-3 mb-4 border border-yellow-500"><p class="text-yellow-200 text-sm">‚ö†Ô∏è Pelanggaran: ${currentState.violations}x pindah tab</p></div>`
        : '';
      
      const modal = showModal(
        `
        <div id="examResultCard" class="text-center">
          <div class="text-6xl mb-4">üéâ</div>
          <h3 class="text-3xl font-bold text-white mb-3">UJIAN SELESAI</h3>
          ${warningMessage}
          ${violationWarning}
          <div class="bg-gradient-to-br from-blue-900 to-purple-900 rounded-2xl p-6 mb-4 border-2 border-blue-400">
            <p class="text-blue-200 text-lg mb-2">Skor Anda</p>
            <p class="text-white text-6xl font-black">${score}</p>
          </div>
          <div class="bg-slate-800 rounded-xl p-4 mb-4 border border-slate-600">
            <p class="text-slate-400 text-sm mb-2">Nama Siswa</p>
            <p class="text-white text-lg font-bold">${currentState.namaSiswa}</p>
            <p class="text-blue-300 text-sm mt-1">${currentState.kelas}</p>
          </div>
          <div class="flex justify-center gap-4 text-center mb-4">
            <div class="bg-green-900 bg-opacity-40 rounded-xl p-4 flex-1 border border-green-500">
              <p class="text-green-300 text-sm">Benar</p>
              <p class="text-white text-2xl font-bold">${correct}</p>
            </div>
            <div class="bg-red-900 bg-opacity-40 rounded-xl p-4 flex-1 border border-red-500">
              <p class="text-red-300 text-sm">Salah</p>
              <p class="text-white text-2xl font-bold">${total - correct}</p>
            </div>
          </div>
          <div class="bg-slate-800 rounded-lg p-3 border border-slate-600">
            <p class="text-slate-300 text-sm">‚è±Ô∏è Waktu yang digunakan: <strong>${timeUsed}</strong></p>
          </div>
        </div>
        `,
        [
          { text: 'Kembali ke Beranda', type: 'primary', onClick: () => {
            showPage('landingPage');
            document.getElementById('namaSiswa').value = '';
            document.getElementById('pilihKelas').value = '';
          }}
        ]
      );
    }

    const namaInput = document.getElementById('namaSiswa');
    const autocompleteDropdown = document.getElementById('autocompleteDropdown');
    
    namaInput.addEventListener('input', function(e) {
      const searchTerm = e.target.value.trim().toLowerCase();
      
      if (searchTerm.length === 0) {
        autocompleteDropdown.style.display = 'none';
        return;
      }
      
      const matches = daftarSiswa.filter(nama => 
        nama.toLowerCase().includes(searchTerm)
      );
      
      if (matches.length === 0) {
        autocompleteDropdown.style.display = 'none';
        return;
      }
      
      autocompleteDropdown.innerHTML = matches.slice(0, 8).map(nama => {
        const regex = new RegExp(`(${searchTerm})`, 'gi');
        const highlightedName = nama.replace(regex, '<span class="autocomplete-highlight">$1</span>');
        
        return `<div class="autocomplete-item" data-name="${nama}">${highlightedName}</div>`;
      }).join('');
      
      autocompleteDropdown.style.display = 'block';
      
      autocompleteDropdown.querySelectorAll('.autocomplete-item').forEach(item => {
        item.addEventListener('click', function() {
          namaInput.value = this.dataset.name;
          autocompleteDropdown.style.display = 'none';
        });
      });
    });
    
    document.addEventListener('click', function(e) {
      if (e.target !== namaInput && !autocompleteDropdown.contains(e.target)) {
        autocompleteDropdown.style.display = 'none';
      }
    });

    document.getElementById('btnAdminLogin').addEventListener('click', function() {
      showModal(
        `
        <div class="text-center">
          <div class="text-6xl mb-4">üîê</div>
          <h3 class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-400 mb-2">
            ADMIN LOGIN
          </h3>
          <p class="text-slate-300">Panel Kontrol Admin</p>
        </div>
        <form id="adminLoginForm" class="space-y-4 mt-6">
          <div>
            <label class="block text-blue-300 font-bold mb-2">Username</label>
            <input 
              type="text" 
              id="adminUsername" 
              required
              class="w-full px-4 py-3 bg-slate-900 text-white rounded-lg border-2 border-slate-600 focus:border-blue-400 focus:outline-none"
              placeholder="Masukkan username"
            >
          </div>
          <div>
            <label class="block text-purple-300 font-bold mb-2">Password</label>
            <input 
              type="password" 
              id="adminPassword" 
              required
              class="w-full px-4 py-3 bg-slate-900 text-white rounded-lg border-2 border-slate-600 focus:border-purple-400 focus:outline-none"
              placeholder="Masukkan password"
            >
          </div>
        </form>
        `,
        [
          { text: 'Batal', type: 'secondary', onClick: () => {} },
          { text: 'Login', type: 'primary', onClick: () => {
            const username = document.getElementById('adminUsername').value.trim();
            const password = document.getElementById('adminPassword').value.trim();

            if (username === 'riskialpian' && password === 'Widiawati1124') {
              isAdminLoggedIn = true;
              showPage('adminPage');
              updateAdminDashboard();
              
              if (adminUpdateInterval) {
                clearInterval(adminUpdateInterval);
              }
              adminUpdateInterval = setInterval(() => {
                if (isAdminLoggedIn) {
                  updateAdminDashboard();
                }
              }, 3000);
            } else {
              showModal(
                `
                <div class="text-center">
                  <div class="text-6xl mb-4">‚ùå</div>
                  <h3 class="text-2xl font-bold text-white mb-3">LOGIN GAGAL</h3>
                  <p class="text-red-300 text-lg">
                    Username atau password salah!
                  </p>
                </div>
                `,
                [
                  { text: 'OK', type: 'primary', onClick: () => {} }
                ]
              );
            }
          }}
        ]
      );
    });

    document.getElementById('btnAdminLogout').addEventListener('click', function() {
      showModal(
        `
        <div class="text-center">
          <div class="text-6xl mb-4">üëã</div>
          <h3 class="text-2xl font-bold text-white mb-3">LOGOUT</h3>
          <p class="text-slate-300 text-lg">
            Yakin ingin keluar dari dashboard admin?
          </p>
        </div>
        `,
        [
          { text: 'Batal', type: 'secondary', onClick: () => {} },
          { text: 'Ya, Logout', type: 'primary', onClick: () => {
            isAdminLoggedIn = false;
            if (adminUpdateInterval) {
              clearInterval(adminUpdateInterval);
            }
            showPage('landingPage');
          }}
        ]
      );
    });

    document.getElementById('tabOverview').addEventListener('click', function() {
      switchAdminTab('Overview');
    });

    document.getElementById('tabLiveMonitoring').addEventListener('click', function() {
      switchAdminTab('LiveMonitoring');
    });

    document.getElementById('tabResults').addEventListener('click', function() {
      switchAdminTab('Results');
    });

    document.getElementById('tabManageStudents').addEventListener('click', function() {
      switchAdminTab('ManageStudents');
    });

    function switchAdminTab(tab) {
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });
      
      document.getElementById('tabContentOverview').classList.add('hidden');
      document.getElementById('tabContentLiveMonitoring').classList.add('hidden');
      document.getElementById('tabContentResults').classList.add('hidden');
      document.getElementById('tabContentManageStudents').classList.add('hidden');
      
      if (tab === 'Overview') {
        document.getElementById('tabOverview').classList.add('active');
        document.getElementById('tabContentOverview').classList.remove('hidden');
      } else if (tab === 'LiveMonitoring') {
        document.getElementById('tabLiveMonitoring').classList.add('active');
        document.getElementById('tabContentLiveMonitoring').classList.remove('hidden');
        updateLiveMonitoring();
      } else if (tab === 'Results') {
        document.getElementById('tabResults').classList.add('active');
        document.getElementById('tabContentResults').classList.remove('hidden');
        updateResultsTab();
      } else if (tab === 'ManageStudents') {
        document.getElementById('tabManageStudents').classList.add('active');
        document.getElementById('tabContentManageStudents').classList.remove('hidden');
        updateStudentListTab();
      }
    }

    function updateAdminDashboard() {
      const totalStudents = allExamData.length;
      const activeExams = allExamData.filter(d => d.status === 'sedang_ujian').length;
      const totalViolations = allExamData.reduce((sum, d) => sum + (d.violations || 0), 0);
      const completedExams = allExamData.filter(d => d.status === 'selesai' || d.status === 'waktu_habis');
      const avgScore = completedExams.length > 0 
        ? Math.round(completedExams.reduce((sum, d) => sum + (d.skor || 0), 0) / completedExams.length)
        : 0;
      
      document.getElementById('adminTotalStudents').textContent = totalStudents;
      document.getElementById('adminActiveExams').textContent = activeExams;
      document.getElementById('adminTotalViolations').textContent = totalViolations;
      document.getElementById('adminAvgScore').textContent = avgScore;
      
      const tbody = document.getElementById('adminTableBody');
      if (allExamData.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="10" class="p-8 text-center text-slate-400">
              <div class="text-4xl mb-2">üìä</div>
              <p>Belum ada data ujian</p>
            </td>
          </tr>
        `;
      } else {
        const studentHistory = {};
        allExamData.forEach(data => {
          const key = `${data.nama_siswa}_${data.kelas}`;
          if (!studentHistory[key]) {
            studentHistory[key] = [];
          }
          studentHistory[key].push(data);
        });
        
        const uniqueStudents = Object.values(studentHistory).map(history => {
          return history[history.length - 1];
        });
        
        tbody.innerHTML = uniqueStudents.map((data, idx) => {
          const key = `${data.nama_siswa}_${data.kelas}`;
          const historyCount = studentHistory[key].length;
          
          const statusColor = data.status === 'sedang_ujian' 
            ? 'bg-green-600' 
            : data.status === 'waktu_habis'
            ? 'bg-red-600'
            : 'bg-blue-600';
          
          const statusText = data.status === 'sedang_ujian'
            ? 'üî¥ Sedang Ujian'
            : data.status === 'waktu_habis'
            ? '‚è∞ Waktu Habis'
            : '‚úÖ Selesai';
          
          return `
            <tr class="border-b border-slate-700 hover:bg-slate-800 transition-colors">
              <td class="p-3 text-sm">${idx + 1}</td>
              <td class="p-3 text-sm font-bold">${data.nama_siswa}</td>
              <td class="p-3 text-sm">${data.kelas}</td>
              <td class="p-3 text-sm font-bold text-blue-400">${data.skor || 0}</td>
              <td class="p-3 text-sm">${data.jawaban_benar || 0}/${data.total_soal || 0}</td>
              <td class="p-3 text-sm">${data.waktu_selesai || '-'}</td>
              <td class="p-3 text-sm ${data.violations > 0 ? 'text-red-400 font-bold' : ''}">${data.violations || 0}</td>
              <td class="p-3 text-sm">
                <button onclick="showStudentHistory('${data.nama_siswa}', '${data.kelas}')" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded-lg text-xs font-bold transition-all">
                  ${historyCount}x Ujian
                </button>
              </td>
              <td class="p-3 text-sm">
                <span class="${statusColor} px-3 py-1 rounded-full text-xs font-bold">
                  ${statusText}
                </span>
              </td>
              <td class="p-3 text-sm">
                <button onclick="resetStudentData('${data.nama_siswa}', '${data.kelas}')" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-lg text-xs font-bold transition-all">
                  üîÑ Reset
                </button>
              </td>
            </tr>
          `;
        }).join('');
      }
    }

    function updateLiveMonitoring() {
      const filterKelas = document.getElementById('filterKelas').value;
      const activeExams = allExamData.filter(d => {
        const matchStatus = d.status === 'sedang_ujian';
        const matchKelas = !filterKelas || d.kelas === filterKelas;
        return matchStatus && matchKelas;
      });
      
      const container = document.getElementById('liveMonitoringContent');
      
      if (activeExams.length === 0) {
        container.innerHTML = `
          <div class="col-span-full text-center py-12">
            <div class="text-6xl mb-4">üëÄ</div>
            <p class="text-slate-400 text-lg">Tidak ada ujian yang sedang berlangsung</p>
          </div>
        `;
      } else {
        container.innerHTML = activeExams.map(data => {
          const progress = Math.round((data.soal_selesai || 0) / (data.total_soal || 1) * 100);
          const violationColor = (data.violations || 0) === 0 ? 'text-green-400' : 
                                 (data.violations || 0) <= 2 ? 'text-yellow-400' : 'text-red-400';
          
          return `
            <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl p-6 border-2 border-green-500 relative">
              <div class="absolute top-4 right-4">
                <div class="live-indicator"></div>
              </div>
              <h4 class="text-white font-bold text-lg mb-2">${data.nama_siswa}</h4>
              <p class="text-blue-300 text-sm mb-4">${data.kelas}</p>
              <div class="space-y-3">
                <div class="flex justify-between text-sm">
                  <span class="text-slate-400">Progress</span>
                  <span class="text-white font-bold">${data.soal_selesai || 0}/${data.total_soal || 0}</span>
                </div>
                <div class="w-full bg-slate-700 rounded-full h-2">
                  <div class="bg-gradient-to-r from-green-500 to-emerald-500 h-2 rounded-full transition-all" style="width: ${progress}%"></div>
                </div>
                <div class="flex justify-between text-sm">
                  <span class="text-slate-400">Pelanggaran</span>
                  <span class="${violationColor} font-bold">${data.violations || 0}x</span>
                </div>
                <div class="flex justify-between text-sm">
                  <span class="text-slate-400">Waktu Berjalan</span>
                  <span class="text-white font-bold">${calculateTimeElapsed(data.waktu_mulai)}</span>
                </div>
                <div class="grid grid-cols-2 gap-2 mt-4">
                  <button onclick="sendMessageToStudent('${data.__backendId}')" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-xs font-bold transition-all flex items-center justify-center gap-1">
                    <span>üí¨</span>
                    <span>Pesan</span>
                  </button>
                  <button onclick="cancelStudentExam('${data.__backendId}')" class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg text-xs font-bold transition-all flex items-center justify-center gap-1">
                    <span>‚ùå</span>
                    <span>Batalkan</span>
                  </button>
                </div>
              </div>
            </div>
          `;
        }).join('');
      }
    }

    function calculateTimeElapsed(waktuMulai) {
      if (!waktuMulai) return '00:00';
      const start = new Date(waktuMulai);
      const now = new Date();
      const diff = Math.floor((now - start) / 1000);
      const minutes = Math.floor(diff / 60);
      const seconds = diff % 60;
      return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    window.sendMessageToStudent = function(backendId) {
      const student = allExamData.find(d => d.__backendId === backendId);
      if (!student) return;
      
      showModal(
        `
        <div class="text-center">
          <div class="text-5xl mb-4">üí¨</div>
          <h3 class="text-2xl font-bold text-white mb-3">KIRIM PESAN</h3>
          <p class="text-blue-300 mb-4">Kepada: <strong>${student.nama_siswa}</strong> (${student.kelas})</p>
        </div>
        <form id="messageForm" class="mt-4">
          <label class="block text-purple-300 font-bold mb-2">Pesan Anda</label>
          <textarea 
            id="messageText" 
            required
            rows="4"
            class="w-full px-4 py-3 bg-slate-900 text-white rounded-lg border-2 border-slate-600 focus:border-purple-400 focus:outline-none resize-none"
            placeholder="Ketik pesan untuk siswa..."
          ></textarea>
        </form>
        `,
        [
          { text: 'Batal', type: 'secondary', onClick: () => {} },
          { text: 'Kirim Pesan', type: 'primary', onClick: async () => {
            const message = document.getElementById('messageText').value.trim();
            if (!message) return;
            
            const messageData = {
              target_student: student.nama_siswa,
              target_kelas: student.kelas,
              message: message,
              timestamp: new Date().toISOString(),
              type: 'personal'
            };
            
            if (window.dataSdk) {
              await window.dataSdk.create(messageData);
              showModal(
                `
                <div class="text-center">
                  <div class="text-6xl mb-4">‚úÖ</div>
                  <h3 class="text-2xl font-bold text-white mb-3">PESAN TERKIRIM</h3>
                  <p class="text-green-300 text-lg">
                    Pesan berhasil dikirim ke ${student.nama_siswa}
                  </p>
                </div>
                `,
                [
                  { text: 'OK', type: 'primary', onClick: () => {} }
                ]
              );
            }
          }}
        ]
      );
    };

    window.cancelStudentExam = function(backendId) {
      const student = allExamData.find(d => d.__backendId === backendId);
      if (!student) return;
      
      showModal(
        `
        <div class="text-center">
          <div class="text-6xl mb-4">‚ö†Ô∏è</div>
          <h3 class="text-2xl font-bold text-white mb-3">BATALKAN UJIAN SISWA</h3>
          <p class="text-red-300 text-lg mb-4">
            Yakin ingin membatalkan ujian <strong>${student.nama_siswa}</strong>?
          </p>
          <div class="bg-red-900 bg-opacity-30 rounded-lg p-4 border border-red-500">
            <p class="text-red-200 text-sm">
              ‚ö†Ô∏è Tindakan ini akan menghentikan ujian siswa dan menandai sebagai dibatalkan oleh admin
            </p>
          </div>
        </div>
        `,
        [
          { text: 'Tidak, Kembali', type: 'secondary', onClick: () => {} },
          { text: 'Ya, Batalkan Ujian', type: 'primary', onClick: async () => {
            if (window.dataSdk) {
              student.status = 'dibatalkan_admin';
              student.waktu_dibatalkan = new Date().toISOString();
              await window.dataSdk.update(student);
              
              const cancelMessage = {
                target_student: student.nama_siswa,
                target_kelas: student.kelas,
                message: 'Ujian Anda telah dibatalkan oleh Admin. Silakan hubungi pengawas ujian.',
                timestamp: new Date().toISOString(),
                type: 'cancel',
                force_reload: true
              };
              await window.dataSdk.create(cancelMessage);
              
              showModal(
                `
                <div class="text-center">
                  <div class="text-6xl mb-4">‚úÖ</div>
                  <h3 class="text-2xl font-bold text-white mb-3">UJIAN DIBATALKAN</h3>
                  <p class="text-green-300 text-lg">
                    Ujian ${student.nama_siswa} berhasil dibatalkan
                  </p>
                </div>
                `,
                [
                  { text: 'OK', type: 'primary', onClick: () => {} }
                ]
              );
            }
          }}
        ]
      );
    };

    document.getElementById('filterKelas').addEventListener('change', updateLiveMonitoring);

    document.getElementById('btnBroadcastMessage').addEventListener('click', function() {
      showModal(
        `
        <div class="text-center">
          <div class="text-6xl mb-4">üì¢</div>
          <h3 class="text-2xl font-bold text-white mb-3">BROADCAST PESAN</h3>
          <p class="text-purple-300 mb-4">Kirim pesan ke semua siswa yang sedang ujian</p>
        </div>
        <form id="broadcastForm" class="mt-4 space-y-4">
          <div>
            <label class="block text-blue-300 font-bold mb-2">Target Kelas</label>
            <select id="broadcastKelas" class="w-full px-4 py-3 bg-slate-900 text-white rounded-lg border-2 border-slate-600 focus:border-blue-400 focus:outline-none">
              <option value="">Semua Kelas</option>
              <option value="Kelas 7A">Kelas 7A</option>
              <option value="Kelas 7B">Kelas 7B</option>
              <option value="Kelas 8">Kelas 8</option>
              <option value="Kelas 9A">Kelas 9A</option>
              <option value="Kelas 9B">Kelas 9B</option>
            </select>
          </div>
          <div>
            <label class="block text-purple-300 font-bold mb-2">Pesan Broadcast</label>
            <textarea 
              id="broadcastText" 
              required
              rows="4"
              class="w-full px-4 py-3 bg-slate-900 text-white rounded-lg border-2 border-slate-600 focus:border-purple-400 focus:outline-none resize-none"
              placeholder="Ketik pesan untuk siswa..."
            ></textarea>
          </div>
        </form>
        `,
        [
          { text: 'Batal', type: 'secondary', onClick: () => {} },
          { text: 'Kirim Broadcast', type: 'primary', onClick: async () => {
            const message = document.getElementById('broadcastText').value.trim();
            const targetKelas = document.getElementById('broadcastKelas').value;
            
            if (!message) return;
            
            const activeStudents = allExamData.filter(d => {
              const isActive = d.status === 'sedang_ujian';
              const matchKelas = !targetKelas || d.kelas === targetKelas;
              return isActive && matchKelas;
            });
            
            if (activeStudents.length === 0) {
              showModal(
                `
                <div class="text-center">
                  <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                  <h3 class="text-2xl font-bold text-white mb-3">TIDAK ADA SISWA</h3>
                  <p class="text-yellow-300 text-lg">
                    Tidak ada siswa yang sedang ujian${targetKelas ? ' di ' + targetKelas : ''}
                  </p>
                </div>
                `,
                [
                  { text: 'OK', type: 'primary', onClick: () => {} }
                ]
              );
              return;
            }
            
            if (window.dataSdk) {
              for (const student of activeStudents) {
                const messageData = {
                  target_student: student.nama_siswa,
                  target_kelas: student.kelas,
                  message: message,
                  timestamp: new Date().toISOString(),
                  type: 'broadcast'
                };
                await window.dataSdk.create(messageData);
              }
              
              showModal(
                `
                <div class="text-center">
                  <div class="text-6xl mb-4">‚úÖ</div>
                  <h3 class="text-2xl font-bold text-white mb-3">BROADCAST TERKIRIM</h3>
                  <p class="text-green-300 text-lg mb-2">
                    Pesan berhasil dikirim ke <strong>${activeStudents.length} siswa</strong>
                  </p>
                  <p class="text-slate-300 text-sm">
                    ${targetKelas ? 'Kelas: ' + targetKelas : 'Semua kelas'}
                  </p>
                </div>
                `,
                [
                  { text: 'OK', type: 'primary', onClick: () => {} }
                ]
              );
            }
          }}
        ]
      );
    });

    function updateResultsTab() {
      const filterKelas = document.getElementById('filterKelasResults').value;
      const completedExams = allExamData.filter(d => {
        const matchStatus = d.status === 'selesai' || d.status === 'waktu_habis';
        const matchKelas = !filterKelas || d.kelas === filterKelas;
        return matchStatus && matchKelas;
      });
      
      const tbody = document.getElementById('resultsTableBody');
      
      if (completedExams.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="6" class="p-8 text-center text-slate-400">
              <div class="text-4xl mb-2">üìà</div>
              <p>Belum ada hasil ujian${filterKelas ? ' untuk kelas ' + filterKelas : ''}</p>
            </td>
          </tr>
        `;
      } else {
        tbody.innerHTML = completedExams.map((data, idx) => {
          return `
            <tr class="border-b border-slate-700 hover:bg-slate-800 transition-colors">
              <td class="p-3 text-sm">${idx + 1}</td>
              <td class="p-3 text-sm font-bold">${data.nama_siswa}</td>
              <td class="p-3 text-sm">${data.kelas}</td>
              <td class="p-3 text-sm font-bold ${data.skor >= 75 ? 'text-green-400' : data.skor >= 60 ? 'text-yellow-400' : 'text-red-400'}">${data.skor}</td>
              <td class="p-3 text-sm">${data.jawaban_benar}/${data.total_soal}</td>
              <td class="p-3 text-sm">${data.waktu_selesai}</td>
            </tr>
          `;
        }).join('');
      }
    }

    document.getElementById('filterKelasResults').addEventListener('change', updateResultsTab);

    window.showStudentHistory = function(namaSiswa, kelas) {
      const key = `${namaSiswa}_${kelas}`;
      const history = allExamData.filter(d => d.nama_siswa === namaSiswa && d.kelas === kelas);
      
      if (history.length === 0) {
        showModal(
          `
          <div class="text-center">
            <div class="text-6xl mb-4">üìä</div>
            <h3 class="text-2xl font-bold text-white mb-3">TIDAK ADA RIWAYAT</h3>
            <p class="text-slate-300 text-lg">
              Tidak ada riwayat ujian untuk ${namaSiswa}
            </p>
          </div>
          `,
          [
            { text: 'OK', type: 'primary', onClick: () => {} }
          ]
        );
        return;
      }
      
      const historyHTML = history.map((data, idx) => {
        const statusColor = data.status === 'sedang_ujian' 
          ? 'bg-green-600' 
          : data.status === 'waktu_habis'
          ? 'bg-red-600'
          : 'bg-blue-600';
        
        const statusText = data.status === 'sedang_ujian'
          ? 'üî¥ Sedang Ujian'
          : data.status === 'waktu_habis'
          ? '‚è∞ Waktu Habis'
          : '‚úÖ Selesai';
        
        return `
          <div class="bg-slate-800 rounded-lg p-4 mb-3 border border-slate-600">
            <div class="flex justify-between items-start mb-2">
              <div>
                <p class="text-white font-bold">Ujian ke-${idx + 1}</p>
                <p class="text-slate-400 text-xs">${data.waktu_submit ? new Date(data.waktu_submit).toLocaleString('id-ID') : '-'}</p>
              </div>
              <span class="${statusColor} px-2 py-1 rounded-full text-xs font-bold">
                ${statusText}
              </span>
            </div>
            <div class="grid grid-cols-2 gap-2 text-sm">
              <div>
                <p class="text-slate-400">Skor</p>
                <p class="text-blue-400 font-bold">${data.skor || 0}</p>
              </div>
              <div>
                <p class="text-slate-400">Benar</p>
                <p class="text-green-400 font-bold">${data.jawaban_benar || 0}/${data.total_soal || 0}</p>
              </div>
              <div>
                <p class="text-slate-400">Waktu</p>
                <p class="text-white font-bold">${data.waktu_selesai || '-'}</p>
              </div>
              <div>
                <p class="text-slate-400">Pelanggaran</p>
                <p class="${data.violations > 0 ? 'text-red-400' : 'text-green-400'} font-bold">${data.violations || 0}x</p>
              </div>
            </div>
          </div>
        `;
      }).join('');
      
      showModal(
        `
        <div class="text-center mb-4">
          <div class="text-5xl mb-3">üìö</div>
          <h3 class="text-2xl font-bold text-white mb-2">RIWAYAT UJIAN</h3>
          <p class="text-blue-300 font-bold">${namaSiswa}</p>
          <p class="text-purple-300 text-sm">${kelas}</p>
        </div>
        <div class="max-h-96 overflow-y-auto">
          ${historyHTML}
        </div>
        <div class="bg-gradient-to-r from-blue-900 to-purple-900 rounded-lg p-4 mt-4 border border-blue-500">
          <p class="text-white text-center font-bold">Total: ${history.length} kali mengikuti ujian</p>
        </div>
        `,
        [
          { text: 'Tutup', type: 'primary', onClick: () => {} }
        ]
      );
    };

    window.resetStudentData = function(namaSiswa, kelas) {
      const studentData = allExamData.filter(d => d.nama_siswa === namaSiswa && d.kelas === kelas);
      
      if (studentData.length === 0) {
        showModal(
          `
          <div class="text-center">
            <div class="text-6xl mb-4">‚ö†Ô∏è</div>
            <h3 class="text-2xl font-bold text-white mb-3">TIDAK ADA DATA</h3>
            <p class="text-yellow-300 text-lg">
              Tidak ada data untuk direset
            </p>
          </div>
          `,
          [
            { text: 'OK', type: 'primary', onClick: () => {} }
          ]
        );
        return;
      }
      
      showModal(
        `
        <div class="text-center">
          <div class="text-6xl mb-4">üîÑ</div>
          <h3 class="text-2xl font-bold text-white mb-3">RESET DATA SISWA</h3>
          <p class="text-red-300 text-lg mb-2">
            Yakin ingin reset semua data ujian?
          </p>
          <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl p-4 mb-4 border border-blue-500">
            <p class="text-white font-bold mb-1">${namaSiswa}</p>
            <p class="text-blue-300 text-sm mb-3">${kelas}</p>
            <p class="text-yellow-300 text-sm">Total ${studentData.length} riwayat ujian akan dihapus</p>
          </div>
          <div class="bg-red-900 bg-opacity-30 rounded-lg p-4 border border-red-500">
            <p class="text-red-200 text-sm">
              ‚ö†Ô∏è Tindakan ini tidak dapat dibatalkan!
            </p>
          </div>
        </div>
        `,
        [
          { text: 'Batal', type: 'secondary', onClick: () => {} },
          { text: 'Ya, Reset Semua', type: 'primary', onClick: async () => {
            if (window.dataSdk) {
              for (const data of studentData) {
                await window.dataSdk.delete(data);
              }
              
              showModal(
                `
                <div class="text-center">
                  <div class="text-6xl mb-4">‚úÖ</div>
                  <h3 class="text-2xl font-bold text-white mb-3">DATA DIRESET</h3>
                  <p class="text-green-300 text-lg mb-2">
                    Semua data ujian ${namaSiswa} berhasil dihapus
                  </p>
                  <p class="text-slate-300 text-sm">
                    ${studentData.length} riwayat ujian telah dihapus
                  </p>
                </div>
                `,
                [
                  { text: 'OK', type: 'primary', onClick: () => {} }
                ]
              );
            }
          }}
        ]
      );
    };

    document.getElementById('btnDownloadPDF').addEventListener('click', function() {
      if (!window.jsPDF) {
        showModal(
          `
          <div class="text-center">
            <div class="text-6xl mb-4">‚ùå</div>
            <h3 class="text-2xl font-bold text-white mb-3">ERROR</h3>
            <p class="text-red-300 text-lg">
              Library PDF belum dimuat!
            </p>
          </div>
          `,
          [
            { text: 'OK', type: 'primary', onClick: () => {} }
          ]
        );
        return;
      }
      
      const { jsPDF } = window.jsPDF;
      const doc = new jsPDF();
      
      doc.setFontSize(18);
      doc.text('HASIL UJIAN INFORMATIKA', 105, 20, { align: 'center' });
      doc.setFontSize(12);
      doc.text('SMPS Muhammadiyah Karimun', 105, 28, { align: 'center' });
      
      const tableData = allExamData
        .filter(d => d.status === 'selesai' || d.status === 'waktu_habis')
        .map((data, idx) => [
          idx + 1,
          data.nama_siswa,
          data.kelas,
          data.skor,
          `${data.jawaban_benar}/${data.total_soal}`,
          data.waktu_selesai,
          data.violations || 0
        ]);
      
      doc.autoTable({
        startY: 35,
        head: [['No', 'Nama Siswa', 'Kelas', 'Skor', 'Benar', 'Waktu', 'Pelanggaran']],
        body: tableData,
        theme: 'grid',
        headStyles: { fillColor: [59, 130, 246] }
      });
      
      doc.save('hasil-ujian-semua-kelas.pdf');
    });

    document.getElementById('btnDownloadClassPDF').addEventListener('click', function() {
      const filterKelas = document.getElementById('filterKelasResults').value;
      
      if (!filterKelas) {
        showModal(
          `
          <div class="text-center">
            <div class="text-6xl mb-4">‚ö†Ô∏è</div>
            <h3 class="text-2xl font-bold text-white mb-3">PILIH KELAS</h3>
            <p class="text-yellow-300 text-lg">
              Mohon pilih kelas terlebih dahulu!
            </p>
          </div>
          `,
          [
            { text: 'OK', type: 'primary', onClick: () => {} }
          ]
        );
        return;
      }
      
      const completedExams = allExamData.filter(d => {
        const matchStatus = d.status === 'selesai' || d.status === 'waktu_habis';
        const matchKelas = d.kelas === filterKelas;
        return matchStatus && matchKelas;
      });
      
      if (completedExams.length === 0) {
        showModal(
          `
          <div class="text-center">
            <div class="text-6xl mb-4">‚ö†Ô∏è</div>
            <h3 class="text-2xl font-bold text-white mb-3">TIDAK ADA DATA</h3>
            <p class="text-yellow-300 text-lg">
              Belum ada data hasil ujian untuk ${filterKelas}
            </p>
          </div>
          `,
          [
            { text: 'OK', type: 'primary', onClick: () => {} }
          ]
        );
        return;
      }
      
      try {
        const { jsPDF } = window.jsPDF;
        const doc = new jsPDF();
        
        doc.setFontSize(18);
        doc.setFont('helvetica', 'bold');
        doc.text('HASIL UJIAN INFORMATIKA', 105, 20, { align: 'center' });
        doc.setFontSize(12);
        doc.setFont('helvetica', 'normal');
        doc.text('SMPS Muhammadiyah Karimun', 105, 28, { align: 'center' });
        doc.setFont('helvetica', 'bold');
        doc.text(`Kelas: ${filterKelas}`, 105, 35, { align: 'center' });
        
        const tableData = completedExams.map((data, idx) => [
          idx + 1,
          data.nama_siswa,
          data.skor,
          `${data.jawaban_benar}/${data.total_soal}`,
          data.waktu_selesai
        ]);
        
        doc.autoTable({
          startY: 42,
          head: [['No', 'Nama Siswa', 'Skor', 'Benar/Total', 'Waktu']],
          body: tableData,
          theme: 'grid',
          headStyles: { 
            fillColor: [59, 130, 246],
            fontSize: 11,
            fontStyle: 'bold'
          },
          bodyStyles: {
            fontSize: 10
          },
          columnStyles: {
            0: { cellWidth: 15 },
            1: { cellWidth: 70 },
            2: { cellWidth: 25 },
            3: { cellWidth: 35 },
            4: { cellWidth: 35 }
          }
        });
        
        const pdfBlob = doc.output('blob');
        const url = URL.createObjectURL(pdfBlob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `hasil-ujian-${filterKelas.replace(/\s+/g, '-').toLowerCase()}-${Date.now()}.pdf`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showModal(
          `
          <div class="text-center">
            <div class="text-6xl mb-4">‚úÖ</div>
            <h3 class="text-2xl font-bold text-white mb-3">PDF BERHASIL DIUNDUH</h3>
            <p class="text-green-300 text-lg mb-2">
              File PDF untuk ${filterKelas} telah diunduh
            </p>
            <p class="text-slate-300 text-sm">
              Cek folder Download Anda
            </p>
          </div>
          `,
          [
            { text: 'OK', type: 'primary', onClick: () => {} }
          ]
        );
      } catch (error) {
        console.error('Error generating PDF:', error);
        showModal(
          `
          <div class="text-center">
            <div class="text-6xl mb-4">‚ùå</div>
            <h3 class="text-2xl font-bold text-white mb-3">GAGAL MEMBUAT PDF</h3>
            <p class="text-red-300 text-lg">
              Terjadi kesalahan: ${error.message}
            </p>
          </div>
          `,
          [
            { text: 'OK', type: 'primary', onClick: () => {} }
          ]
        );
      }
    });

    function updateStudentListTab() {
      const searchTerm = document.getElementById('searchStudentInput').value.toLowerCase();
      const filteredStudents = daftarSiswa.filter(nama => 
        nama.toLowerCase().includes(searchTerm)
      );
      
      document.getElementById('totalStudentCount').textContent = daftarSiswa.length;
      
      const tbody = document.getElementById('studentListTableBody');
      
      if (filteredStudents.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="4" class="p-8 text-center text-slate-400">
              <div class="text-4xl mb-2">üîç</div>
              <p>${searchTerm ? 'Tidak ada siswa yang cocok dengan pencarian' : 'Tidak ada siswa terdaftar'}</p>
            </td>
          </tr>
        `;
      } else {
        tbody.innerHTML = filteredStudents.map((nama, idx) => {
          const examCount = allExamData.filter(d => d.nama_siswa === nama).length;
          
          return `
            <tr class="border-b border-slate-700 hover:bg-slate-800 transition-colors">
              <td class="p-3 text-sm">${idx + 1}</td>
              <td class="p-3 text-sm font-bold">${nama}</td>
              <td class="p-3 text-sm text-blue-400">${examCount}x</td>
              <td class="p-3 text-sm">
                <div class="flex gap-2">
                  <button onclick="editStudentName('${nama}')" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg text-xs font-bold transition-all">
                    ‚úèÔ∏è Edit
                  </button>
                  <button onclick="deleteStudent('${nama}')" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-lg text-xs font-bold transition-all">
                    üóëÔ∏è Hapus
                  </button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
      }
    }

    document.getElementById('searchStudentInput').addEventListener('input', updateStudentListTab);

    document.getElementById('btnSortAZ').addEventListener('click', function() {
      daftarSiswa.sort((a, b) => a.localeCompare(b));
      updateStudentListTab();
      showModal(
        `
        <div class="text-center">
          <div class="text-6xl mb-4">‚úÖ</div>
          <h3 class="text-2xl font-bold text-white mb-3">DIURUTKAN A-Z</h3>
          <p class="text-green-300 text-lg">
            Daftar siswa telah diurutkan secara alfabetis
          </p>
        </div>
        `,
        [
          { text: 'OK', type: 'primary', onClick: () => {} }
        ]
      );
    });

    document.getElementById('btnRefreshList').addEventListener('click', function() {
      updateStudentListTab();
      showModal(
        `
        <div class="text-center">
          <div class="text-6xl mb-4">üîÑ</div>
          <h3 class="text-2xl font-bold text-white mb-3">REFRESH BERHASIL</h3>
          <p class="text-green-300 text-lg">
            Daftar siswa telah diperbarui
          </p>
        </div>
        `,
        [
          { text: 'OK', type: 'primary', onClick: () => {} }
        ]
      );
    });

    document.getElementById('btnAddStudent').addEventListener('click', function() {
      showModal(
        `
        <div class="text-center">
          <div class="text-6xl mb-4">‚ûï</div>
          <h3 class="text-2xl font-bold text-white mb-3">TAMBAH SISWA BARU</h3>
          <p class="text-slate-300 mb-4">Masukkan nama siswa yang akan ditambahkan</p>
        </div>
        <form id="addStudentForm" class="mt-4">
          <label class="block text-blue-300 font-bold mb-2">Nama Lengkap Siswa</label>
          <input 
            type="text" 
            id="newStudentName" 
            required
            class="w-full px-4 py-3 bg-slate-900 text-white rounded-lg border-2 border-slate-600 focus:border-blue-400 focus:outline-none"
            placeholder="Contoh: AHMAD FAUZI"
          >
          <p class="text-slate-400 text-xs mt-2">üí° Gunakan huruf kapital untuk konsistensi</p>
        </form>
        `,
        [
          { text: 'Batal', type: 'secondary', onClick: () => {} },
          { text: 'Tambah Siswa', type: 'primary', onClick: () => {
            const newName = document.getElementById('newStudentName').value.trim();
            
            if (!newName) {
              showModal(
                `
                <div class="text-center">
                  <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                  <h3 class="text-2xl font-bold text-white mb-3">NAMA KOSONG</h3>
                  <p class="text-yellow-300 text-lg">
                    Mohon masukkan nama siswa!
                  </p>
                </div>
                `,
                [
                  { text: 'OK', type: 'primary', onClick: () => {} }
                ]
              );
              return;
            }
            
            const isDuplicate = daftarSiswa.some(nama => 
              nama.toLowerCase() === newName.toLowerCase()
            );
            
            if (isDuplicate) {
              showModal(
                `
                <div class="text-center">
                  <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                  <h3 class="text-2xl font-bold text-white mb-3">SISWA SUDAH ADA</h3>
                  <p class="text-yellow-300 text-lg">
                    Nama "<strong>${newName}</strong>" sudah terdaftar!
                  </p>
                </div>
                `,
                [
                  { text: 'OK', type: 'primary', onClick: () => {} }
                ]
              );
              return;
            }
            
            daftarSiswa.push(newName);
            updateStudentListTab();
            
            showModal(
              `
              <div class="text-center">
                <div class="text-6xl mb-4">‚úÖ</div>
                <h3 class="text-2xl font-bold text-white mb-3">SISWA DITAMBAHKAN</h3>
                <p class="text-green-300 text-lg mb-2">
                  <strong>${newName}</strong> berhasil ditambahkan!
                </p>
                <div class="bg-blue-900 bg-opacity-30 rounded-lg p-3 border border-blue-500 mt-3">
                  <p class="text-blue-200 text-sm">
                    Total siswa sekarang: <strong>${daftarSiswa.length}</strong>
                  </p>
                </div>
              </div>
              `,
              [
                { text: 'OK', type: 'primary', onClick: () => {} }
              ]
            );
          }}
        ]
      );
    });

    window.editStudentName = function(oldName) {
      showModal(
        `
        <div class="text-center">
          <div class="text-6xl mb-4">‚úèÔ∏è</div>
          <h3 class="text-2xl font-bold text-white mb-3">EDIT NAMA SISWA</h3>
          <p class="text-slate-300 mb-2">Nama saat ini:</p>
          <p class="text-blue-300 font-bold mb-4">${oldName}</p>
        </div>
        <form id="editStudentForm" class="mt-4">
          <label class="block text-purple-300 font-bold mb-2">Nama Baru</label>
          <input 
            type="text" 
            id="editedStudentName" 
            required
            value="${oldName}"
            class="w-full px-4 py-3 bg-slate-900 text-white rounded-lg border-2 border-slate-600 focus:border-purple-400 focus:outline-none"
          >
        </form>
        `,
        [
          { text: 'Batal', type: 'secondary', onClick: () => {} },
          { text: 'Simpan Perubahan', type: 'primary', onClick: () => {
            const newName = document.getElementById('editedStudentName').value.trim();
            
            if (!newName) {
              showModal(
                `
                <div class="text-center">
                  <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                  <h3 class="text-2xl font-bold text-white mb-3">NAMA KOSONG</h3>
                  <p class="text-yellow-300 text-lg">
                    Mohon masukkan nama siswa!
                  </p>
                </div>
                `,
                [
                  { text: 'OK', type: 'primary', onClick: () => {} }
                ]
              );
              return;
            }
            
            if (newName === oldName) {
              showModal(
                `
                <div class="text-center">
                  <div class="text-6xl mb-4">‚ÑπÔ∏è</div>
                  <h3 class="text-2xl font-bold text-white mb-3">TIDAK ADA PERUBAHAN</h3>
                  <p class="text-slate-300 text-lg">
                    Nama tidak mengalami perubahan
                  </p>
                </div>
                `,
                [
                  { text: 'OK', type: 'primary', onClick: () => {} }
                ]
              );
              return;
            }
            
            const isDuplicate = daftarSiswa.some(nama => 
              nama.toLowerCase() === newName.toLowerCase() && nama !== oldName
            );
            
            if (isDuplicate) {
              showModal(
                `
                <div class="text-center">
                  <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                  <h3 class="text-2xl font-bold text-white mb-3">NAMA SUDAH ADA</h3>
                  <p class="text-yellow-300 text-lg">
                    Nama "<strong>${newName}</strong>" sudah digunakan siswa lain!
                  </p>
                </div>
                `,
                [
                  { text: 'OK', type: 'primary', onClick: () => {} }
                ]
              );
              return;
            }
            
            const index = daftarSiswa.indexOf(oldName);
            if (index !== -1) {
              daftarSiswa[index] = newName;
            }
            
            updateStudentListTab();
            
            showModal(
              `
              <div class="text-center">
                <div class="text-6xl mb-4">‚úÖ</div>
                <h3 class="text-2xl font-bold text-white mb-3">NAMA DIPERBARUI</h3>
                <div class="bg-slate-800 rounded-lg p-4 mb-3 border border-slate-600">
                  <p class="text-slate-400 text-sm mb-2">Nama Lama:</p>
                  <p class="text-red-300 line-through">${oldName}</p>
                  <p class="text-slate-400 text-sm mt-3 mb-2">Nama Baru:</p>
                  <p class="text-green-300 font-bold">${newName}</p>
                </div>
                <p class="text-slate-300 text-sm">
                  Perubahan berhasil disimpan
                </p>
              </div>
              `,
              [
                { text: 'OK', type: 'primary', onClick: () => {} }
              ]
            );
          }}
        ]
      );
    };

    window.deleteStudent = function(nama) {
      const examCount = allExamData.filter(d => d.nama_siswa === nama).length;
      
      showModal(
        `
        <div class="text-center">
          <div class="text-6xl mb-4">üóëÔ∏è</div>
          <h3 class="text-2xl font-bold text-white mb-3">HAPUS SISWA</h3>
          <p class="text-red-300 text-lg mb-2">
            Yakin ingin menghapus siswa ini?
          </p>
          <div class="bg-slate-800 rounded-lg p-4 mb-4 border border-slate-600">
            <p class="text-white font-bold">${nama}</p>
            <p class="text-slate-400 text-sm mt-2">
              ${examCount > 0 ? `Memiliki ${examCount}x riwayat ujian` : 'Belum pernah mengikuti ujian'}
            </p>
          </div>
          <div class="bg-red-900 bg-opacity-30 rounded-lg p-4 border border-red-500">
            <p class="text-red-200 text-sm">
              ‚ö†Ô∏è Tindakan ini akan menghapus siswa dari daftar!<br>
              ${examCount > 0 ? '<strong>Data ujian siswa ini tetap tersimpan</strong>' : ''}
            </p>
          </div>
        </div>
        `,
        [
          { text: 'Batal', type: 'secondary', onClick: () => {} },
          { text: 'Ya, Hapus Siswa', type: 'primary', onClick: () => {
            const index = daftarSiswa.indexOf(nama);
            if (index !== -1) {
              daftarSiswa.splice(index, 1);
            }
            
            updateStudentListTab();
            
            showModal(
              `
              <div class="text-center">
                <div class="text-6xl mb-4">‚úÖ</div>
                <h3 class="text-2xl font-bold text-white mb-3">SISWA DIHAPUS</h3>
                <p class="text-green-300 text-lg mb-2">
                  <strong>${nama}</strong> telah dihapus dari daftar
                </p>
                <div class="bg-blue-900 bg-opacity-30 rounded-lg p-3 border border-blue-500 mt-3">
                  <p class="text-blue-200 text-sm">
                    Sisa siswa terdaftar: <strong>${daftarSiswa.length}</strong>
                  </p>
                </div>
              </div>
              `,
              [
                { text: 'OK', type: 'primary', onClick: () => {} }
              ]
            );
          }}
        ]
      );
    };

    initializeDataSdk();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9aa526ee0665ce81',t:'MTc2NTEyMjM0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
